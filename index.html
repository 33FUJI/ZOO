<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>33æ—¥æœ¬å‹•ç‰©åœ’ | ä»£è³¼ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root{--bg:#f4f4f4;--blue:#003399;--red:#d9534f}
        body{font-family:sans-serif;margin:0;height:100vh;display:flex;flex-direction:column;overflow:hidden;background:var(--bg)}
        header{padding:10px;background:#fff;border-bottom:1px solid #ddd;display:flex;gap:10px;z-index:100}
        .nick-input{flex:1;padding:12px;border:1px solid #ccc;border-radius:8px;font-size:16px}
        .main-container{display:flex;flex:1;overflow:hidden}
        .left-menu{width:38%;background:#eee;overflow-y:auto;border-right:1px solid #ddd}
        .menu-item{padding:20px 10px;border-bottom:1px solid #ddd;font-size:0.95em;cursor:pointer;background:#eee}
        .menu-item.active{background:#fff;font-weight:bold;color:var(--blue);border-left:5px solid var(--blue)}
        .right-content{width:62%;background:#fff;overflow-y:auto;padding:15px;box-sizing:border-box}
        .spec-card{border:1px solid #f0f0f0;border-radius:10px;padding:15px;margin-bottom:12px;background:#fcfcfc;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
        .spec-info{display:flex;justify-content:space-between;margin-bottom:10px;font-weight:bold}
        .qty-row{display:flex;align-items:center;justify-content:flex-end;gap:12px}
        .qty-btn{width:35px;height:35px;border:1px solid var(--blue);background:#fff;color:var(--blue);border-radius:50%;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .bottom-bar{background:#fff;border-top:2px solid var(--blue);padding:15px 20px 30px;z-index:1000}
        .summary-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .submit-btn{width:100%;padding:15px;background:var(--blue);color:#fff;border:none;border-radius:10px;font-weight:bold;font-size:1.1em}
        #cart-modal{position:fixed;bottom:90px;left:0;right:0;background:#fff;max-height:65%;overflow-y:auto;z-index:999;display:none;border-radius:20px 20px 0 0;padding:20px;box-shadow:0 -5px 25px rgba(0,0,0,0.15)}
        .cart-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #eee;align-items:center}
        #admin-panel{position:fixed;inset:0;background:#fff;z-index:2000;display:none;padding:20px;overflow-y:auto}
        table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
        th,td{border:1px solid #ddd;padding:10px;text-align:left}
    </style>
</head>
<body>

<header>
    <input type="text" id="user-nick" class="nick-input" placeholder="âœ è«‹å…ˆè¼¸å…¥æ‚¨çš„æš±ç¨±">
    <button onclick="toggleAdmin()" id="admin-btn" style="display:none;background:var(--blue);color:#fff;border:none;padding:10px 15px;border-radius:8px">é€²å…¥ç®¡ç†</button>
</header>

<div class="main-container">
    <div class="left-menu" id="left-menu"></div>
    <div class="right-content" id="right-content">
        <div style="text-align:center;color:#999;margin-top:100px;">â¬… è«‹å…ˆé¸æ“‡å·¦å´å•†å“</div>
    </div>
</div>

<div id="cart-modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
        <h3 style="margin:0">ğŸ›’ ç™»è¨˜æ˜ç´° (å¯åœ¨æ­¤ä¿®æ­£)</h3>
        <span onclick="toggleCart()" style="cursor:pointer;padding:5px 12px;background:#eee;border-radius:5px">é—œé–‰</span>
    </div>
    <div id="cart-details-list"></div>
</div>

<div class="bottom-bar" id="order-bar" style="display:none">
    <div class="summary-info">
        <div onclick="toggleCart()" style="color:var(--blue);text-decoration:underline;cursor:pointer;font-weight:bold">ä¿®æ­£æ˜ç´° (<span id="cart-count">0</span>)</div>
        <div style="font-size:1.4em;font-weight:bold;color:var(--red)">Total $<span id="total-val">0</span></div>
    </div>
    <button class="submit-btn" onclick="submitOrder()">âœ… ç¢ºèªç™»è¨˜ä¸‹å–®</button>
</div>

<div id="admin-panel">
    <div style="display:flex;justify-content:space-between">
        <h2>ğŸ“Š å¾Œå°è¨‚å–®çµ±è¨ˆ</h2>
        <button onclick="toggleAdmin()" style="padding:10px">é—œé–‰</button>
    </div>
    <div style="background:#fff5f5;padding:15px;border-radius:10px;margin-bottom:20px">
        <h3 style="margin-top:0;color:var(--red)">ğŸ“¦ æ¡è²·åŒ¯ç¸½ (ç³»çµ±è‡ªå‹•åŠ ç¸½)</h3>
        <div id="summary-table"></div>
    </div>
    <h3>ğŸ“ åŸå§‹è¨‚å–®æ˜ç´°</h3>
    <div id="order-table"></div>
</div>

<script>
    // 1. åŸºæœ¬è¨­å®š
    const config={apiKey:"AIzaSyD7KmXt_PjFzyYKz4tXGQAmz_wvmmSjAm4",databaseURL:"https://zoo-62638-default-rtdb.firebaseio.com",projectId:"zoo-62638"};
    firebase.initializeApp(config);
    const db = firebase.database();

    // ä¿åº•è³‡æ–™ï¼šä¸€æ‰“é–‹ç¶²é çµ•å°æœƒçœ‹åˆ°çš„å…§å®¹
    let cart = {};
    let cloudData = {
        "å®˜æ–¹é€±é‚Š": {
            "p1": {n:"æˆå“¡å¨ƒå¨ƒé‘°åŒ™åœˆ", p:880, s:"åˆ©ç‰¹,å¸Œæ¾ˆ,è—è²,ç¥ç«¥,éŠ€èµ«,æ±æµ·,å§‹æº,å²æ—­,åœ­è³¢"},
            "p2": {n:"æ¼”å”±æœƒæ‡‰æ´Tæ¤", p:1050, s:"Må°ºå¯¸,Lå°ºå¯¸,XLå°ºå¯¸"}
        },
        "è¶…å¸‚ä»£è³¼": {
            "m1": {n:"æ—¥æ¸…æ³¡éºµ", p:65, s:"é†¬æ²¹å£å‘³,æµ·é®®å£å‘³,å’–å“©å£å‘³"}
        }
    };

    // 2. ç›£è½æš±ç¨±èˆ‡è³‡æ–™
    document.getElementById('user-nick').addEventListener('input', e => {
        document.getElementById('admin-btn').style.display = (e.target.value === '1239') ? 'block' : 'none';
    });

    db.ref('products').on('value', sn => {
        if(sn.val()) cloudData = sn.val();
        renderLeftMenu();
    });

    // 3. æ¸²æŸ“åŠŸèƒ½
    function renderLeftMenu() {
        const menu = document.getElementById('left-menu');
        menu.innerHTML = "";
        Object.keys(cloudData).forEach(cat => {
            Object.keys(cloudData[cat]).forEach(id => {
                const p = cloudData[cat][id];
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.id = `m-${id}`;
                div.innerText = p.n;
                div.onclick = () => renderRightSpec(cat, id);
                menu.appendChild(div);
            });
        });
    }

    function renderRightSpec(cat, id) {
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
        document.getElementById(`m-${id}`).classList.add('active');
        const p = cloudData[cat][id];
        const specs = (p.s || "å–®ä¸€è¦æ ¼").split(',');
        let html = `<h2 style="margin-top:0;color:var(--blue)">${p.n}</h2>`;
        specs.forEach(s => {
            const key = `${cat}|${id}|${s.trim()}`;
            html += `
            <div class="spec-card">
                <div class="spec-info"><span>${s.trim()}</span><span style="color:var(--red)">$${p.p}</span></div>
                <div class="qty-row">
                    <button class="qty-btn" onclick="updateQty('${key}',-1)">-</button>
                    <span id="qty-${key}" style="min-width:30px;text-align:center;font-weight:bold;font-size:1.2em">${cart[key]||0}</span>
                    <button class="qty-btn" onclick="updateQty('${key}',1)">+</button>
                </div>
            </div>`;
        });
        document.getElementById('right-content').innerHTML = html;
    }

    function updateQty(key, delta) {
        cart[key] = (cart[key] || 0) + delta;
        if(cart[key] <= 0) delete cart[key];
        const el = document.getElementById(`qty-${key}`);
        if(el) el.innerText = cart[key] || 0;
        updateCartUI();
    }

    function updateCartUI() {
        const bar = document.getElementById('order-bar');
        const listEl = document.getElementById('cart-details-list');
        let total = 0, count = 0, html = "";
        Object.keys(cart).forEach(k => {
            const p = k.split('|');
            const info = cloudData[p[0]][p[1]];
            total += info.p * cart[k];
            count += cart[k];
            html += `
            <div class="cart-item">
                <div style="flex:1"><b>${info.n}</b><br><small>${p[2]}</small></div>
                <div class="qty-row">
                    <button class="qty-btn" style="width:25px;height:25px;font-size:16px" onclick="updateQty('${k}',-1)">-</button>
                    <span style="font-weight:bold">${cart[k]}</span>
                    <button class="qty-btn" style="width:25px;height:25px;font-size:16px" onclick="updateQty('${k}',1)">+</button>
                </div>
            </div>`;
        });
        bar.style.display = count > 0 ? 'block' : 'none';
        document.getElementById('cart-count').innerText = count;
        document.getElementById('total-val').innerText = total;
        listEl.innerHTML = html || "<div style='text-align:center;color:#999;padding:20px'>æ¸…å–®æ˜¯ç©ºçš„</div>";
    }

    function toggleCart() {
        const m = document.getElementById('cart-modal');
        m.style.display = (m.style.display === 'block') ? 'none' : 'block';
    }

    function submitOrder() {
        const nick = document.getElementById('user-nick').value;
        if(!nick || nick === '1239') return alert("è«‹è¼¸å…¥æš±ç¨±å¾Œå†ä¸‹å–®");
        db.ref('orders').push({
            nick: nick,
            items: cart,
            total: document.getElementById('total-val').innerText,
            time: new Date().toLocaleString()
        }).then(() => {
            alert("âœ… ç™»è¨˜æˆåŠŸï¼");
            cart = {}; updateCartUI();
            document.getElementById('cart-modal').style.display='none';
            location.reload(); 
        });
    }

    function toggleAdmin() {
        const p = document.getElementById('admin-panel');
        p.style.display = (p.style.display === 'block') ? 'none' : 'block';
        if(p.style.display === 'block') loadAdminData();
    }

    function loadAdminData() {
        db.ref('orders').once('value', sn => {
            let stats = {}, orderHtml = '<table><tr><th>æš±ç¨±</th><th>æ˜ç´°</th></tr>';
            sn.forEach(d => {
                const v = d.val();
                let detail = "";
                Object.keys(v.items).forEach(k => {
                    const p = k.split('|');
                    const itemName = `${cloudData[p[0]][p[1]].n}(${p[2]})`;
                    detail += `Â· ${itemName} x ${v.items[k]}<br>`;
                    stats[itemName] = (stats[itemName] || 0) + v.items[k];
                });
                orderHtml += `<tr><td>${v.nick}</td><td>${detail}</td></tr>`;
            });
            let statHtml = '<table><tr><th>å•†å“èˆ‡è¦æ ¼</th><th>ç¸½æ¡è²·éœ€æ±‚</th></tr>';
            Object.keys(stats).sort().forEach(name => {
                statHtml += `<tr><td>${name}</td><td style="color:red;font-weight:bold;font-size:1.1em">${stats[name]}</td></tr>`;
            });
            document.getElementById('summary-table').innerHTML = statHtml + '</table>';
            document.getElementById('order-table').innerHTML = orderHtml + '</table>';
        });
    }

    // åˆå§‹åŒ–æ¸²æŸ“
    renderLeftMenu();
</script>
</body>
</html>
