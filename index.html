<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>33æ—¥æœ¬å‹•ç‰©åœ’</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F5F2ED; --card: #FFFFFF; --main: #A68B6D; --sub: #829481; --text: #4A4A4A; --border: #E0D7CE; --accent: #C5A358; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* å°è¦½åˆ— */
        .topbar { background: var(--card); padding: 12px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .wordmark { font-weight: 700; color: var(--main); font-size: 1.2em; cursor: pointer; }
        .back-btn { background: var(--bg); border: 1px solid var(--border); padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: bold; }

        /* å…¥å£èˆ‡åˆ†é  */
        #event-screen { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .event-grid { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .event-card { background: #1A1C22; color: white; padding: 40px 30px; border-radius: 15px; width: 220px; text-align: center; cursor: pointer; transition: 0.3s; }
        
        /* ä¸»ç‰ˆé¢ */
        .main { display: flex; flex: 1; overflow: hidden; }
        .pane { flex: 1; overflow-y: auto; padding: 25px; }
        .ptable { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .ptable th { background: #EFE9E2; padding: 18px; text-align: left; color: var(--main); }
        .ptable td { padding: 20px; border-bottom: 1px solid var(--bg); }
        
        /* è¦æ ¼æŒ‰éˆ• */
        .spec-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .spec-btn { border: 1px solid var(--border); background: var(--bg); padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .spec-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
        
        /* å´é‚Šè³¼ç‰©è»Š */
        .sidebar { width: 360px; background: var(--card); border-left: 1px solid var(--border); display: flex; flex-direction: column; padding: 25px; }
        .cart-item { background: var(--bg); padding: 15px; border-radius: 10px; margin-bottom: 12px; position: relative; }
        
        /* å¾Œå°ç®¡ç†é¢æ¿ */
        #admin-pane { position: fixed; inset: 0; background: #f0f0f0; z-index: 3000; display: none; padding: 30px; overflow-y: auto; color: #333; }
        .admin-section { background: white; padding: 20px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status-tag { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .st-0 { background: #ddd; } .st-1 { background: #cce5ff; color: #004085; } .st-2 { background: #fff3cd; color: #856404; } .st-3 { background: #d4edda; color: #155724; }
        
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { cursor: pointer; }
    </style>
</head>
<body>

<div id="event-screen">
    <h2 style="color:var(--main); margin-bottom:40px;">33æ—¥æœ¬å‹•ç‰©åœ’</h2>
    <div class="event-grid">
        <div class="event-card" onclick="selectEvent('æ—¥æœ¬è¶…å¸‚')"><h3>æ—¥æœ¬è¶…å¸‚</h3><p>é€²å…¥åˆ—è¡¨</p></div>
        <div class="event-card" onclick="selectEvent('SS10æ—¥æœ¬å‘¨é‚Š')"><h3>SS10æ—¥æœ¬å‘¨é‚Š</h3><p>é€²å…¥åˆ—è¡¨</p></div>
        <div class="event-card" onclick="selectEvent('SS10è¿½åŠ å‘¨é‚Š')"><h3>SS10è¿½åŠ å‘¨é‚Š</h3><p>é€²å…¥åˆ—è¡¨</p></div>
    </div>
    <button onclick="openAdmin()" style="margin-top:80px; background:none; border:none; color:#ccc; cursor:pointer;">âš™ï¸ ç®¡ç†å¾Œå°</button>
</div>

<div id="admin-pane">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h1>âš™ï¸ 33æ—¥æœ¬å‹•ç‰©åœ’ ç®¡ç†å¾Œå°</h1>
        <button onclick="location.reload()" style="padding:10px 20px; background:#444; color:white; border:none; border-radius:5px;">é€€å‡ºç™»å‡º</button>
    </div>

    <div class="admin-section">
        <h3>â• æ–°å¢å•†å“</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 2fr auto; gap: 10px; align-items: end;">
            <div>å ´æ¬¡<br><select id="new-e"><option>æ—¥æœ¬è¶…å¸‚</option><option>SS10æ—¥æœ¬å‘¨é‚Š</option><option>SS10è¿½åŠ å‘¨é‚Š</option></select></div>
            <div>å“å<br><input id="new-n" type="text" placeholder="ä¾‹: T-shirt"></div>
            <div>åƒ¹æ ¼<br><input id="new-p" type="number" placeholder="é‡‘é¡"></div>
            <div>è¦æ ¼ (é€—è™Ÿéš”é–‹)<br><input id="new-s" type="text" style="width:100%" placeholder="ä¾‹: M,L æˆ– ç‰¹,èµ«,æµ·"></div>
            <button onclick="addNewProduct()" style="background:var(--sub); color:white; border:none; padding:10px; border-radius:5px;">æ–°å¢</button>
        </div>
    </div>

    <div class="admin-section">
        <h3>ğŸ“‹ è¨‚å–®ç®¡ç† (å¯ä¿®æ”¹ç‹€æ…‹èˆ‡å…§å®¹)</h3>
        <div id="admin-orders"></div>
    </div>

    <div class="admin-section">
        <h3>ğŸ“¦ ç¾æœ‰å•†å“åº« (å¯åˆªé™¤)</h3>
        <table style="width:100%; text-align:left;" border="1" cellpadding="10" cellspacing="0">
            <thead><tr><th>å ´æ¬¡</th><th>å“å</th><th>åƒ¹æ ¼</th><th>è¦æ ¼</th><th>æ“ä½œ</th></tr></thead>
            <tbody id="admin-prods"></tbody>
        </table>
    </div>
</div>

<header class="topbar">
    <div class="wordmark" onclick="goHome()">33æ—¥æœ¬å‹•ç‰©åœ’</div>
    <div id="event-label" style="font-weight:700; color:var(--main); margin-left: 20px;"></div>
    <button class="back-btn" onclick="goHome()">å›ä¸Šä¸€é </button>
</header>

<div class="main">
    <div class="pane">
        <table class="ptable">
            <thead><tr><th>å•†å“è³‡è¨Š</th><th style="text-align:right; padding-right:40px;">é¸æ“‡è¦æ ¼èˆ‡æ•¸é‡</th></tr></thead>
            <tbody id="prod-tbody"></tbody>
        </table>
    </div>
    <div class="sidebar">
        <h3>é¸è³¼æ¸…å–®</h3>
        <div id="cart-items" style="flex:1; overflow-y:auto;"></div>
        <div class="total-row"><span>ç¸½è¨ˆ</span><span>$ <span id="total-val">0</span></span></div>
        <input type="text" id="nick" style="width:100%; padding:14px; margin-bottom:10px; border:1px solid var(--border); border-radius:10px;" placeholder="æ‚¨çš„ Line æš±ç¨±">
        <button style="background:var(--sub); color:white; width:100%; padding:16px; border-radius:10px; border:none; font-weight:bold; cursor:pointer;" onclick="submitOrder()">ç¢ºèªé€å‡ºè¨‚å–®</button>
    </div>
</div>

<script>
    const sjMembers = "ç‰¹,æ¾ˆ,é›²,ç«¥,èµ«,æµ·,æº,æ—­,åœ­";
    const masterList = [
        { id: 101, e: "æ—¥æœ¬è¶…å¸‚", n: "T-shirt (M/L)", p: 1200, s: "M,L" },
        { id: 102, e: "æ—¥æœ¬è¶…å¸‚", n: "åŠæ‹‰éŠä¸Šè¡£ (M/L)", p: 2700, s: "M,L" },
        { id: 103, e: "æ—¥æœ¬è¶…å¸‚", n: "æ–¹å·¾", p: 700, s: "" },
        { id: 106, e: "æ—¥æœ¬è¶…å¸‚", n: "å‹•ç‰©æ£’æ£’ç³–åŠé£¾", p: 500, s: sjMembers },
        { id: 201, e: "SS10æ—¥æœ¬å‘¨é‚Š", n: "01 æ¼”å”±æœƒTæ¤", p: 1070, s: "M,L" },
        { id: 306, e: "SS10è¿½åŠ å‘¨é‚Š", n: "06 æ‰‡å¥—", p: 1100, s: sjMembers }
    ];

    let products = JSON.parse(localStorage.getItem('33_prods_v3')) || masterList;
    let orders = JSON.parse(localStorage.getItem('33_orders_v3')) || [];
    let cart = [];
    let activeSpecs = {};

    function goHome() { document.getElementById('event-screen').style.display = 'flex'; }
    function selectEvent(e) {
        document.getElementById('event-screen').style.display = 'none';
        document.getElementById('event-label').innerText = "ğŸ“ " + e;
        renderProducts(e);
    }

    // --- å‰å°åŠŸèƒ½ ---
    function renderProducts(e) {
        const tbody = document.getElementById('prod-tbody');
        tbody.innerHTML = products.filter(p => p.e === e).map(p => {
            const specList = p.s ? p.s.split(',') : [];
            return `<tr>
                <td><div class="prod-name">${p.n}</div><div class="prod-price">$${p.p}</div>
                    <div class="spec-grid">${specList.map(s => `<button class="spec-btn" id="spec-${p.id}-${s}" onclick="pickSpec(${p.id},'${s}')">${s}</button>`).join('')}</div>
                </td>
                <td align="right">
                    <div style="display:flex; align-items:center; justify-content:flex-end; gap:10px;">
                        <div class="qty-ctrl"><button onclick="adjQty(${p.id},-1)">-</button><input id="qty-${p.id}" value="1" readonly><button onclick="adjQty(${p.id},1)">+</button></div>
                        <button class="btn-add" onclick="addToCart(${p.id})">åŠ å…¥</button>
                    </div>
                </td></tr>`;
        }).join('');
    }

    function pickSpec(pid, s) {
        const p = products.find(x => x.id === pid);
        p.s.split(',').forEach(spec => document.getElementById(`spec-${pid}-${spec}`)?.classList.remove('active'));
        document.getElementById(`spec-${pid}-${s}`).classList.add('active');
        activeSpecs[pid] = s;
    }

    function adjQty(pid, v) {
        const el = document.getElementById(`qty-${pid}`);
        let n = parseInt(el.value) + v;
        if(n > 0) el.value = n;
    }

    function addToCart(pid) {
        const p = products.find(x => x.id === pid);
        const s = activeSpecs[pid] || (p.s ? "" : "ç„¡");
        if(p.s && !s) return alert("è«‹é¸è¦æ ¼ï¼");
        cart.push({ n: p.n, s: s, q: parseInt(document.getElementById(`qty-${pid}`).value), p: p.p });
        renderCart();
    }

    function renderCart() {
        let total = 0;
        document.getElementById('cart-items').innerHTML = cart.map((i, idx) => {
            total += (i.p * i.q);
            return `<div class="cart-item"><b>${i.n}</b> (${i.s}) x ${i.q}<button onclick="cart.splice(${idx},1);renderCart()" style="float:right">âœ•</button></div>`;
        }).join('');
        document.getElementById('total-val').innerText = total.toLocaleString();
    }

    function submitOrder() {
        const n = document.getElementById('nick').value;
        if(!n || cart.length === 0) return alert("è«‹å¡«å¯«æš±ç¨±èˆ‡å•†å“");
        orders.unshift({ id: Date.now(), nick: n, items: [...cart], total: document.getElementById('total-val').innerText, time: new Date().toLocaleString(), status: 0 });
        saveAndRefresh();
        alert("ä¸‹å–®å®Œæˆï¼");
        cart = []; renderCart();
    }

    // --- å¾Œå°ç®¡ç†åŠŸèƒ½ ---
    function openAdmin() {
        if(prompt("è«‹è¼¸å…¥å¯†ç¢¼") === "1239") {
            document.getElementById('admin-pane').style.display = 'block';
            renderAdmin();
        }
    }

    function renderAdmin() {
        // æ¸²æŸ“å•†å“
        document.getElementById('admin-prods').innerHTML = products.map((p, i) => `
            <tr><td>${p.e}</td><td>${p.n}</td><td>${p.p}</td><td>${p.s}</td>
            <td><button onclick="deleteProd(${i})" style="color:red">åˆªé™¤</button></td></tr>`).join('');
        
        // æ¸²æŸ“è¨‚å–®
        document.getElementById('admin-orders').innerHTML = orders.length ? orders.map((o, i) => `
            <div style="border:1px solid #ccc; padding:15px; margin-bottom:10px; border-radius:8px;">
                <div style="display:flex; justify-content:space-between;">
                    <b>ğŸ‘¤ å®¢æˆ¶ï¼š${o.nick}</b>
                    <span>ç‹€æ…‹ï¼š<select onchange="updateOrderStatus(${i}, this.value)">
                        <option value="0" ${o.status==0?'selected':''}>å¾…å°å¸³</option>
                        <option value="1" ${o.status==1?'selected':''}>å·²å°å¸³</option>
                        <option value="2" ${o.status==2?'selected':''}>å·²è²·åˆ°</option>
                        <option value="3" ${o.status==3?'selected':''}>å·²ç™¼è²¨</option>
                    </select></span>
                </div>
                <div style="margin:10px 0; font-size:14px; color:#555;">
                    è¨‚å–®å…§å®¹ï¼š<br>
                    ${o.items.map((it, idx) => `
                        - ${it.n} (${it.s}) x ${it.q} 
                        <button onclick="editOrderItem(${i}, ${idx})" style="font-size:10px">æ”¹é‡/åˆªé™¤</button>
                    `).join('<br>')}
                </div>
                <div><b>ç¸½è¨ˆï¼š$${o.total}</b> | ä¸‹å–®æ™‚é–“ï¼š${o.time}</div>
                <button onclick="deleteOrder(${i})" style="color:red; margin-top:10px;">åˆªé™¤æ•´ç­†è¨‚å–®</button>
            </div>`).join('') : "ç›®å‰ç„¡è¨‚å–®";
    }

    function addNewProduct() {
        const e = document.getElementById('new-e').value;
        const n = document.getElementById('new-n').value;
        const p = parseInt(document.getElementById('new-p').value);
        const s = document.getElementById('new-s').value;
        if(!n || !p) return alert("è«‹å¡«å¯«å®Œæ•´å•†å“è³‡æ–™");
        products.push({ id: Date.now(), e, n, p, s });
        saveAndRefresh();
        alert("æ–°å¢æˆåŠŸï¼");
    }

    function deleteProd(i) { if(confirm("ç¢ºå®šåˆªé™¤æ­¤å•†å“ï¼Ÿ")) { products.splice(i, 1); saveAndRefresh(); } }
    function deleteOrder(i) { if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†è¨‚å–®ï¼Ÿ")) { orders.splice(i, 1); saveAndRefresh(); } }
    
    function updateOrderStatus(i, val) {
        orders[i].status = parseInt(val);
        saveAndRefresh();
    }

    function editOrderItem(oIdx, iIdx) {
        const newQty = prompt("è«‹è¼¸å…¥æ–°æ•¸é‡ (è¼¸å…¥ 0 å‰‡åˆªé™¤æ­¤é …)", orders[oIdx].items[iIdx].q);
        if (newQty === null) return;
        if (parseInt(newQty) <= 0) {
            orders[oIdx].items.splice(iIdx, 1);
        } else {
            orders[oIdx].items[iIdx].q = parseInt(newQty);
        }
        // é‡æ–°è¨ˆç®—ç¸½é‡‘é¡
        let newTotal = 0;
        orders[oIdx].items.forEach(it => newTotal += (it.p * it.q));
        orders[oIdx].total = newTotal.toLocaleString();
        saveAndRefresh();
    }

    function saveAndRefresh() {
        localStorage.setItem('33_prods_v3', JSON.stringify(products));
        localStorage.setItem('33_orders_v3', JSON.stringify(orders));
        renderAdmin();
    }
</script>
</body>
</html>
