<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>33 ä»£è³¼ç™»è¨˜ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #2c3e50; --accent: #003399; --bg: #f4f7f9; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; line-height: 1.5; }
        header { background: var(--main); color: white; padding: 18px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; }
        .container { max-width: 600px; margin: 0 auto; padding: 15px; }
        
        /* åˆ†é¡æ¨™é¡Œ */
        .category-section { margin-bottom: 25px; }
        .category-title { font-size: 1.1em; font-weight: bold; color: var(--main); border-left: 5px solid var(--accent); padding-left: 10px; margin-bottom: 12px; }
        
        /* å•†å“å¡ç‰‡ */
        .item-card { background: white; padding: 16px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #e0e6ed; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .item-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: bold; font-size: 1.05em; }
        
        /* è¦æ ¼æŒ‰éˆ• */
        .spec-wrap { display: flex; flex-wrap: wrap; gap: 8px; }
        .spec-btn { flex: 1; min-width: 60px; padding: 10px 5px; border: 1px solid #d1d9e0; border-radius: 8px; background: #fff; cursor: pointer; text-align: center; font-size: 0.9em; font-weight: 600; transition: all 0.2s; }
        .spec-btn:active { background: var(--accent); color: white; transform: scale(0.95); }

        /* å¡«å¯«å½ˆçª—å€åŸŸ */
        #order-form-area { 
            display: none; background: #fff; padding: 20px; border-radius: 15px; 
            border: 2px solid var(--accent); margin: 15px 0; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .input-box { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; margin-bottom: 12px; font-size: 16px; }

        /* çœ‹æ¿ç´€éŒ„ */
        .board-card { background: #fff; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #4caf50; box-shadow: 0 1px 3px rgba(0,0,0,0.05); font-size: 0.95em; }
        
        /* ç®¡ç†å€ */
        #admin-section { display: none; background: #f0f4ff; padding: 15px; border-radius: 12px; margin-top: 30px; border: 1px dashed #78909c; }
        
        footer { text-align: center; padding: 40px 0; color: #99aab5; font-size: 0.85em; }
        .footer-trigger { cursor: pointer; padding: 10px; text-decoration: none; }
    </style>
</head>
<body>

<header onclick="location.reload()">ğŸ’™ 33 ä»£è³¼ç™»è¨˜</header>

<div class="container">
    <div id="display-area" style="text-align: center; padding: 20px; color: #666;">
        ğŸ“¡ é€£ç·šè³‡æ–™åº«ä¸­...
    </div>

    <div id="order-form-area">
        <h3 id="target-display" style="margin-top:0; color:var(--accent);"></h3>
        <label style="font-size: 0.85em; color: #666;">æ‚¨çš„æš±ç¨± (å¿…å¡«)</label>
        <input type="text" id="user-nick" class="input-box" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜">
        
        <label style="font-size: 0.85em; color: #666;">ç™»è¨˜å‚™è¨» (é¸å¡«ï¼Œå¦‚ï¼šç¬¬ä¸€æ³¢ã€ç¾å ´)</label>
        <input type="text" id="order-name" class="input-box" placeholder="ç„¡å‰‡ç•™ç©º">
        
        <div style="margin-bottom:15px; font-weight: bold;">
            æ•¸é‡ï¼š<input type="number" id="target-qty" value="1" min="1" style="width:70px; padding:10px; border-radius: 8px; border: 1px solid #ccc;">
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button onclick="submitData()" style="flex: 2; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 1em; cursor: pointer;">ç¢ºèªé€å‡º</button>
            <button onclick="closeForm()" style="flex: 1; padding: 15px; background: #eee; border: none; border-radius: 8px; cursor: pointer;">å–æ¶ˆ</button>
        </div>
    </div>

    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

    <h3 style="color:var(--main); font-size:1.2em; display: flex; align-items: center; gap: 8px;">
        ğŸ“Š å³æ™‚ç™»è¨˜é€²åº¦
    </h3>
    <div id="live-board">è®€å–åå–®ä¸­...</div>

    <div id="admin-section">
        <h3>âš™ï¸ ç®¡ç†è€…åŠŸèƒ½</h3>
        <button onclick="seedInitialData()" style="width:100%; padding:15px; background:#007bff; color:white; border:none; border-radius:8px; font-weight:bold; margin-bottom:15px; cursor: pointer;">ğŸ”„ é»æˆ‘ï¼šä¸€éµä¸Šæ¶ 15 é …é è¨­å•†å“</button>
        <div style="background:white; padding:15px; border-radius:8px;">
            <strong>æ‰‹å‹•æ–°å¢å•†å“ï¼š</strong><br>
            <input type="text" id="adm-cat" class="input-box" placeholder="åˆ†é¡ (å¦‚: æ—¥æœ¬è¶…å¸‚)" style="margin-top:10px;">
            <input type="text" id="adm-name" class="input-box" placeholder="å•†å“åç¨±">
            <input type="number" id="adm-price" class="input-box" placeholder="å–®åƒ¹">
            <input type="number" id="adm-stock" class="input-box" placeholder="é™é¡æ•¸é‡">
            <button onclick="saveProduct()" style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">å„²å­˜ä¸¦ä¸Šæ¶</button>
        </div>
        <div id="adm-list-area" style="margin-top:15px; font-size: 0.8em; color: #555;"></div>
    </div>
</div>

<footer>
    <div class="footer-trigger" onclick="adminLogin()">Â© 2026 33 ä»£è³¼ç®¡ç†å¾Œå°å…¥å£</div>
</footer>

<script>
// --- Firebase åˆå§‹åŒ– ---
const firebaseConfig = {
    apiKey: "AIzaSyD7KmXt_PjFzyYKz4tXGQAmz_wvmmSjAm4",
    authDomain: "zoo-62638.firebaseapp.com",
    databaseURL: "https://zoo-62638-default-rtdb.firebaseio.com",
    projectId: "zoo-62638",
    storageBucket: "zoo-62638.firebasestorage.app",
    messagingSenderId: "33012710753",
    appId: "1:33012710753:web:318636add1f5ac2f7b5920"
};

if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

let items = {}, activeKey = "", activeSpec = "";

// ç®¡ç†ç™»å…¥
function adminLogin() {
    const pw = prompt("è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼");
    if(pw === "3388") {
        document.getElementById('admin-section').style.display = 'block';
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    } else if(pw !== null) {
        alert("å¯†ç¢¼éŒ¯èª¤");
    }
}

// ç›£è½å•†å“è³‡æ–™ (å³æ™‚æ›´æ–°)
db.ref("products").on("value", (snapshot) => {
    items = snapshot.val() || {};
    const area = document.getElementById('display-area');
    
    if (Object.keys(items).length === 0) {
        area.innerHTML = "ğŸ“­ ç›®å‰å°šç„¡å•†å“ã€‚";
        return;
    }

    const categories = [...new Set(Object.values(items).map(i => i.cat))];
    
    area.innerHTML = categories.map(catName => `
        <div class="category-section">
            <div class="category-title">${catName}</div>
            ${Object.values(items).filter(i => i.cat === catName).map(i => {
                let specs = [];
                if(i.name.includes("(M/L)")) specs = ["M", "L"];
                else if(i.name.includes("(åˆ†æˆå“¡)")) specs = ["ç‰¹", "æ¾ˆ", "é›²", "ç«¥", "èµ«", "æµ·", "æº", "æ—­", "åœ­"];
                
                return `
                    <div class="item-card">
                        <div class="item-info">
                            <span>${i.name}</span>
                            <span style="color:#e91e63;">$${i.price}</span>
                        </div>
                        <div class="spec-wrap">
                            ${specs.length > 0 
                                ? specs.map(s => `<div class="spec-btn" onclick="openForm('${i.key}','${s}')">${s}</div>`).join('') 
                                : `<div class="spec-btn" style="background:var(--main); color:white; border:none;" onclick="openForm('${i.key}','')">ç›´æ¥ç™»è¨˜</div>`}
                        </div>
                    </div>`;
            }).join('')}
        </div>`).join('');

    // æ›´æ–°ç®¡ç†å¾Œå°æ¸…å–®
    document.getElementById('adm-list-area').innerHTML = "ç®¡ç†æ¸…å–®ï¼š" + Object.values(items).map(i => `
        <span style="display:inline-block; background:#ddd; padding:2px 8px; margin:2px; border-radius:4px;">
            ${i.name} <b style="cursor:pointer; color:red;" onclick="deleteProduct('${i.key}')">âœ•</b>
        </span>`).join('');
});

// é–‹å•Ÿç™»è¨˜è¡¨å–®
function openForm(k, s) {
    activeKey = k;
    activeSpec = s;
    document.getElementById('target-display').innerText = "ç™»è¨˜ç›®æ¨™ï¼š" + items[k].name + (s ? " [" + s + "]" : "");
    document.getElementById('order-form-area').style.display = 'block';
    document.getElementById('order-form-area').scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function closeForm() {
    document.getElementById('order-form-area').style.display = 'none';
}

// é€å‡ºç™»è¨˜è³‡æ–™
function submitData() {
    const nick = document.getElementById('user-nick').value.trim();
    const note = document.getElementById('order-name').value.trim();
    const qty = parseInt(document.getElementById('target-qty').value);

    if (!nick) return alert("è«‹è¼¸å…¥æ‚¨çš„æš±ç¨±");
    if (!activeKey) return alert("ç³»çµ±éŒ¯èª¤ï¼Œè«‹åˆ·æ–°é é¢");
    if (qty < 1 || isNaN(qty)) return alert("æ•¸é‡è‡³å°‘ç‚º 1");

    const newOrder = {
        timestamp: Date.now(),
        itemKey: activeKey,
        itemName: items[activeKey].name + (activeSpec ? " [" + activeSpec + "]" : ""),
        note: nick,
        orderName: note || "ä¸€èˆ¬",
        qty: qty,
        time: new Date().toLocaleString('zh-TW', { hour12: false })
    };

    db.ref("history").push(newOrder)
    .then(() => {
        alert("âœ… ç™»è¨˜æˆåŠŸï¼");
        closeForm();
        // æ¸…ç©ºæ¬„ä½
        document.getElementById('order-name').value = "";
        document.getElementById('target-qty').value = "1";
    })
    .catch(err => alert("ç™»è¨˜å¤±æ•—ï¼š" + err.message));
}

// ç›£è½çœ‹æ¿è³‡æ–™
db.ref("history").on("value", (snapshot) => {
    const orders = snapshot.val() || {};
    const sortedKeys = Object.keys(orders).sort((a,b) => orders[b].timestamp - orders[a].timestamp);
    
    document.getElementById('live-board').innerHTML = sortedKeys.map(k => {
        const o = orders[k];
        return `
        <div class="board-card">
            <div style="display:flex; justify-content:space-between;">
                <b>ğŸ‘¤ ${o.note}</b>
                <span style="color:#666; font-size:0.8em;">${o.time}</span>
            </div>
            <div style="margin-top:5px; color: var(--accent); font-weight:bold;">
                ${o.itemName} <span style="color:#f44336;">x ${o.qty}</span>
            </div>
            ${o.orderName !== 'ä¸€èˆ¬' ? `<div style="font-size:0.85em; color:#888;">ğŸ’¬ å‚™è¨»ï¼š${o.orderName}</div>` : ''}
        </div>`;
    }).join('') || "ç›®å‰å°šç„¡ç™»è¨˜è³‡æ–™";
});

// --- ç®¡ç†åŠŸèƒ½ ---
function seedInitialData() {
    if(!confirm("ç¢ºå®šè¦é‡è¨­å•†å“ä¸¦é‡æ–°ä¸Šæ¶å—ï¼Ÿ")) return;
    const list = [
        { cat: "ğŸ›’ æ—¥æœ¬è¶…å¸‚å€", name: "è¶…å¸‚é™å®šé¤…ä¹¾ç›’", price: 350, stock: 20 },
        { cat: "ğŸ›’ æ—¥æœ¬è¶…å¸‚å€", name: "è¶…å¸‚å°é£Ÿ/è»Ÿç³–çµ„", price: 150, stock: 30 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "T-shirt (M/L)", price: 1200, stock: 10 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ‹‰éŠé€£å¸½è¡« (M/L)", price: 2700, stock: 10 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å‹•ç‰©æ£’æ£’ç³–åŠé£¾ (åˆ†æˆå“¡)", price: 500, stock: 45 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "é¦¬å…‹æ¯ (åˆ†æˆå“¡)", price: 800, stock: 18 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å£“å…‹åŠ›ç«‹ç‰Œ(åˆ†æˆå“¡)", price: 700, stock: 27 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å§“åç‰Œ(åˆ†æˆå“¡)", price: 450, stock: 45 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ–¹å·¾", price: 700, stock: 20 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å¯æŠ˜ç’°ä¿è¢‹", price: 750, stock: 15 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ‰‹æè¢‹", price: 1150, stock: 10 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å¾½ç« (éš¨æ©Ÿ)", price: 380, stock: 100 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "éš¨æ©Ÿå¡åŒ…", price: 150, stock: 200 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "éš¨æ©Ÿé›¶é£Ÿç›’", price: 500, stock: 30 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ‰­è›‹(éš¨æ©Ÿ)", price: 200, stock: 100 }
    ];
    
    const data = {};
    list.forEach(i => {
        const k = db.ref("products").push().key;
        data[k] = { ...i, key: k };
    });
    
    db.ref("products").set(data).then(() => alert("âœ… å•†å“ä¸Šæ¶æˆåŠŸï¼"));
}

function saveProduct() {
    const cat = document.getElementById('adm-cat').value;
    const name = document.getElementById('adm-name').value;
    const price = parseInt(document.getElementById('adm-price').value);
    const stock = parseInt(document.getElementById('adm-stock').value);

    if(!cat || !name || isNaN(price)) return alert("è«‹å¡«é½Šå•†å“è³‡è¨Š");

    const k = db.ref("products").push().key;
    db.ref("products/" + k).set({ cat, name, price, stock, key: k })
    .then(() => alert("å•†å“å·²æ–°å¢"));
}

function deleteProduct(k) {
    if(confirm("ç¢ºå®šåˆªé™¤æ­¤å•†å“ï¼Ÿ")) db.ref("products/" + k).remove();
}
</script>

</body>
</html>
