<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>33日本動物園 代購系統</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --bg-soft: #fcfaf2; /* 溫柔米色背景 */
            --card-bg: #ffffff;
            --accent-soft: #94a3b8; /* 柔和灰藍 */
            --text-main: #4a4a4a;
            --price-red: #d9534f;
            --confirm-green: #82c91e;
            --radius: 18px;
        }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg-soft); color: var(--text-main); margin: 0; padding-bottom: 80px; }
        
        header { padding: 30px 20px; text-align: center; font-size: 1.4em; font-weight: bold; color: #5c5c5c; }

        /* 頂部暱稱區 */
        .user-section { padding: 0 20px 20px; }
        .user-input { width: 100%; padding: 15px; border-radius: var(--radius); border: 2px solid #e2e2e2; font-size: 1.1em; box-sizing: border-box; outline: none; transition: border 0.3s; }
        .user-input:focus { border-color: var(--accent-soft); }

        /* 場次卡片入口 */
        .category-grid { padding: 10px 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .cat-card { background: white; padding: 25px 15px; border-radius: var(--radius); text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.03); cursor: pointer; border: 1px solid #f0f0f0; transition: transform 0.2s; }
        .cat-card:active { transform: scale(0.95); }
        .cat-card h3 { margin: 0; font-size: 1em; color: var(--accent-soft); }

        /* 商品清單彈窗 */
        .item-modal { position: fixed; inset: 0; background: white; z-index: 1000; display: none; flex-direction: column; }
        .modal-header { padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #eee; }
        .back-btn { font-size: 1.5em; cursor: pointer; padding: 0 10px; }
        .item-list { flex: 1; overflow-y: auto; padding: 15px; }

        /* 商品列樣式 */
        .p-item { background: #fdfdfd; margin-bottom: 12px; border-radius: 15px; padding: 15px; border: 1px solid #f5f5f5; }
        .p-name { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .spec-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .spec-box { background: #f1f3f5; padding: 8px 12px; border-radius: 12px; display: flex; align-items: center; gap: 10px; }
        .qty-btn { width: 28px; height: 28px; border-radius: 50%; border: none; background: white; color: var(--accent-soft); font-weight: bold; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .qty-num { min-width: 20px; text-align: center; font-weight: bold; }

        /* 下單核對區 */
        .checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 15px 20px; border-top: 1px solid #eee; z-index: 1100; }
        .summary-list { max-height: 120px; overflow-y: auto; font-size: 0.9em; margin-bottom: 10px; color: #666; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 4px; border-bottom: 1px dashed #eee; padding-bottom: 4px; }
        .total-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .total-price { font-size: 1.8em; font-weight: bold; color: var(--price-red); }
        .submit-btn { width: 100%; padding: 15px; border-radius: var(--radius); border: none; background: var(--confirm-green); color: white; font-size: 1.2em; font-weight: bold; cursor: pointer; }

        /* 後台樣式 */
        .admin-modal { position: fixed; inset: 0; background: #fff; z-index: 2000; display: none; flex-direction: column; padding: 20px; }
    </style>
</head>
<body>

<header>✨ 33日本動物園 ✨</header>

<div class="user-section">
    <input type="text" id="user-nick" class="user-input" placeholder="請填寫您的暱稱 (必填)">
</div>

<div class="category-grid" id="category-area">
    </div>

<div id="item-modal" class="item-modal">
    <div class="modal-header">
        <span class="back-btn" onclick="closeModal('item-modal')">❮</span>
        <h2 id="modal-title" style="margin:0 0 0 10px; font-size:1.1em;">商品清單</h2>
    </div>
    <div class="item-list" id="item-list-container"></div>
</div>

<div class="checkout-bar" id="checkout-bar" style="display:none;">
    <div class="summary-list" id="summary-list"></div>
    <div class="total-row">
        <span>已選明細核對：</span>
        <span class="total-price">$<span id="final-total">0</span></span>
    </div>
    <button class="submit-btn" onclick="submitOrder()">確認登記送出</button>
</div>

<div style="display:flex; justify-content:center; gap:20px; margin-top:30px;">
    <button onclick="checkAdmin()" style="border:none; background:none; color:#aaa; font-size:0.9em; text-decoration:underline;">管理後台</button>
    <button onclick="openHistory()" style="border
