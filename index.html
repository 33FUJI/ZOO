<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§¸ 33 æ—¥æœ¬ä»£è³¼ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f8f5f2; --main: #a68b6d; --sub: #829481; --text: #4a4a4a; --white: #ffffff; --border: #e0d7ce; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        header { background: var(--white); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .logo { font-size: 20px; font-weight: 700; color: var(--main); }

        /* å ´æ¬¡é¸æ“‡ */
        #event-screen { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .event-card { background: var(--white); width: 250px; padding: 30px; margin: 10px; border-radius: 15px; text-align: center; cursor: pointer; border: 1px solid var(--border); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        .main-wrap { display: flex; flex: 1; overflow: hidden; }
        
        /* å•†å“å€åŸŸ */
        .prod-area { flex: 1; overflow-y: auto; padding: 20px; }
        .prod-card { background: var(--white); border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .prod-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .prod-name { font-weight: bold; font-size: 1.1em; }
        .prod-price { color: #d9534f; font-weight: bold; }
        
        /* è¦æ ¼æŒ‰éˆ•æ¨£å¼ */
        .spec-wrap { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .spec-btn { background: #f0ede9; border: 1px solid var(--border); padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 0.9em; }
        .spec-btn.active { background: var(--main); color: white; border-color: var(--main); }

        /* è³¼ç‰©è»Šå€åŸŸ */
        .cart-area { width: 350px; background: var(--white); border-left: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; }
        .cart-list { flex: 1; overflow-y: auto; }
        .cart-item { background: #fafafa; padding: 10px; border-radius: 5px; margin-bottom: 8px; font-size: 0.9em; position: relative; }
        .total-box { font-size: 22px; font-weight: bold; color: #d9534f; margin: 15px 0; display: flex; justify-content: space-between; }
        .btn-send { width: 100%; background: var(--sub); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* ç®¡ç†å¾Œå°æ¨£å¼ (éš±è—) */
        #admin-panel { position: fixed; bottom: 0; left: 0; width: 100%; background: #333; color: white; padding: 20px; display: none; z-index: 2000; max-height: 80vh; overflow-y: auto; box-sizing: border-box; }
        .admin-input { padding: 8px; margin: 5px; border-radius: 4px; border: none; }
    </style>
</head>
<body>

<div id="event-screen">
    <h2 style="color:var(--main)">ğŸ§¸ 33 PROXY ä¸‹å–®ç³»çµ±</h2>
    <div id="event-list" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>
    <button onclick="toggleAdmin()" style="margin-top:50px; background:none; border:none; color:#ccc; cursor:pointer;">âš™ ç®¡ç†å…¥å£</button>
</div>

<header>
    <div class="logo" onclick="location.reload()" style="cursor:pointer">âœ¦ 33 PROXY</div>
    <button onclick="location.reload()" style="background:none; border:1px solid var(--border); padding:5px 10px; border-radius:15px; cursor:pointer">åˆ‡æ›å ´æ¬¡</button>
</header>

<div class="main-wrap">
    <div class="prod-area" id="prod-display"></div>
    
    <div class="cart-area">
        <h3 style="margin-top:0">ğŸ›’ æ‚¨çš„æ¸…å–®</h3>
        <div class="cart-list" id="cart-list"></div>
        <div class="total-box"><span>ç¸½è¨ˆ</span><span>$ <span id="total-price">0</span></span></div>
        <input type="text" id="nick" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid var(--border); border-radius:5px; box-sizing:border-box" placeholder="å¡«å¯« Line æš±ç¨±">
        <button class="btn-send" onclick="sendOrder()">ç¢ºèªé€å‡ºè¨‚å–®</button>
    </div>
</div>

<div id="admin-panel">
    <h3>âš™ ç®¡ç†å“¡å¾Œå° <button onclick="toggleAdmin()" style="float:right">é—œé–‰</button></h3>
    <div style="background:#444; padding:15px; border-radius:10px;">
        <h4>æ–°å¢/ä¿®æ”¹å•†å“</h4>
        å ´æ¬¡ï¼š<select id="a-event" class="admin-input"><option>æ—¥æœ¬è¶…å¸‚</option><option>SS10æ—¥æœ¬å‘¨é‚Š</option><option>SS10è¿½åŠ å‘¨é‚Š</option></select>
        å“åï¼š<input id="a-name" class="admin-input" placeholder="ä¾‹å¦‚ï¼šT-shirt">
        åƒ¹æ ¼ï¼š<input id="a-price" type="number" class="admin-input" placeholder="é‡‘é¡">
        è¦æ ¼ï¼š<input id="a-spec" class="admin-input" placeholder="æˆå“¡æˆ–å°ºå¯¸ï¼Œç”¨é€—è™Ÿéš”é–‹ (å¦‚: M,L,XL)">
        <button onclick="saveProduct()" style="padding:8px 20px; background:var(--main); color:white; border:none; cursor:pointer">å„²å­˜å•†å“</button>
    </div>
    <div id="admin-prod-list" style="margin-top:20px"></div>
</div>

<script>
    // é è¨­è³‡æ–™ (é€™éƒ¨åˆ†å¯ä»¥é€éå¾Œå°ä¿®æ”¹)
    let products = JSON.parse(localStorage.getItem('33_db')) || [
        { e: "æ—¥æœ¬è¶…å¸‚", n: "T-shirt", p: 1200, s: ["M", "L"] },
        { e: "æ—¥æœ¬è¶…å¸‚", n: "å‹•ç‰©æ£’æ£’ç³–åŠé£¾", p: 500, s: ["å°å…”", "å°å…«", "å°æ¡ƒ"] },
        { e: "SS10æ—¥æœ¬å‘¨é‚Š", n: "æ¼”å”±æœƒTæ¤", p: 1070, s: ["é»‘è‰²", "ç™½è‰²"] },
        { e: "SS10è¿½åŠ å‘¨é‚Š", n: "æ‹–é‹", p: 1360, s: ["24", "25", "26"] }
    ];

    let cart = [];
    let selectedSpecs = {}; 

    // åˆå§‹åŒ–ï¼šé¡¯ç¤ºå ´æ¬¡
    function init() {
        const events = [...new Set(products.map(p => p.e))];
        const list = document.getElementById('event-list');
        list.innerHTML = events.map(e => `<div class="event-card" onclick="startApp('${e}')"><h3>${e}</h3></div>`).join('');
        renderAdminList();
    }

    // é€²å…¥å ´æ¬¡
    function startApp(eName) {
        document.getElementById('event-screen').style.display = 'none';
        const display = document.getElementById('prod-display');
        const filtered = products.filter(p => p.e === eName);
        
        display.innerHTML = filtered.map((p, i) => `
            <div class="prod-card">
                <div class="prod-info">
                    <span class="prod-name">${p.n}</span>
                    <span class="prod-price">$${p.p}</span>
                </div>
                <div class="spec-wrap">
                    ${p.s.map(s => `<button class="spec-btn" onclick="selectSpec(${i}, '${s}', this)">${s}</button>`).join('')}
                </div>
                <button onclick="addToCart(${i})" style="width:100%; padding:10px; border:none; background:#eee; border-radius:5px; cursor:pointer">åŠ å…¥æ¸…å–®</button>
            </div>
        `).join('');
    }

    // é¸æ“‡è¦æ ¼é‚è¼¯
    function selectSpec(pIdx, spec, btn) {
        // åŒä¸€å±¤æŒ‰éˆ•å…ˆå–æ¶ˆ active
        const btns = btn.parentElement.querySelectorAll('.spec-btn');
        btns.forEach(b => b.classList.remove('active'));
        // é¸ä¸­çš„æŒ‰éˆ•è®Šè‰²
        btn.classList.add('active');
        selectedSpecs[pIdx] = spec;
    }

    function addToCart(pIdx) {
        const p = products[pIdx];
        const s = selectedSpecs[pIdx];
        if (!s && p.s.length > 0) return alert('è«‹å…ˆé»é¸è¦æ ¼æˆ–æˆå“¡ï¼');
        
        cart.push({ n: p.n, p: p.p, s: s || 'ç„¡' });
        renderCart();
    }

    function renderCart() {
        const list = document.getElementById('cart-list');
        const totalDisp = document.getElementById('total-price');
        let total = 0;
        list.innerHTML = cart.map((item, idx) => {
            total += item.p;
            return `<div class="cart-item">
                <b>${item.n}</b> [${item.s}]<br>
                <span style="color:#d9534f">$${item.p}</span>
                <button onclick="removeCart(${idx})" style="position:absolute; right:10px; top:10px; border:none; background:none; color:red; cursor:pointer">âœ•</button>
            </div>`;
        }).join('');
        totalDisp.innerText = total;
    }

    function removeCart(idx) { cart.splice(idx, 1); renderCart(); }

    function sendOrder() {
        const nick = document.getElementById('nick').value;
        if (!nick || cart.length === 0) return alert('è«‹å¡«å¯«æš±ç¨±ä¸¦ç¢ºèªæ¸…å–®å…§å®¹ï¼');
        alert(`ã€33 æ—¥æœ¬ä»£è³¼ä¸‹å–®æˆåŠŸã€‘\nè«‹æˆªåœ–å‚³çµ¦ 33\næš±ç¨±ï¼š${nick}\nç¸½é¡ï¼š$${document.getElementById('total-price').innerText}`);
    }

    // --- ç®¡ç†å“¡é‚è¼¯ ---
    function toggleAdmin() {
        const p = document.getElementById('admin-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function saveProduct() {
        const e = document.getElementById('a-event').value;
        const n = document.getElementById('a-name').value;
        const p = parseInt(document.getElementById('a-price').value);
        const s = document.getElementById('a-spec').value.split(',').filter(x => x);
        
        if (!n || !p) return alert('è«‹å¡«å¯«å“åèˆ‡åƒ¹æ ¼');
        products.push({ e, n, p, s });
        localStorage.setItem('33_db', JSON.stringify(products));
        alert('å„²å­˜æˆåŠŸï¼');
        location.reload();
    }

    function deleteProduct(idx) {
        if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
            products.splice(idx, 1);
            localStorage.setItem('33_db', JSON.stringify(products));
            renderAdminList();
        }
    }

    function renderAdminList() {
        const list = document.getElementById('admin-prod-list');
        list.innerHTML = '<h4>ç¾æœ‰å•†å“æ¸…å–® (é»æ“Šåˆªé™¤)</h4>' + products.map((p, i) => `
            <div style="background:#555; padding:5px; margin:5px; border-radius:5px; font-size:12px">
                [${p.e}] ${p.n} - $${p.p} (${p.s}) 
                <button onclick="deleteProduct(${i})" style="color:red">åˆªé™¤</button>
            </div>
        `).join('');
    }

    init();
</script>

</body>
</html>
