<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>33æ—¥æœ¬å‹•ç‰©åœ’</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root{--blue:#003399;--red:#d9534f;--bg:#f4f4f4}
        body{font-family:sans-serif;margin:0;height:100vh;display:flex;flex-direction:column;background:var(--bg);overflow:hidden}
        header{padding:10px;background:#fff;border-bottom:1px solid #ddd;display:flex;gap:8px;align-items:center}
        .nick-input{flex:1;padding:12px;border:1px solid #ccc;border-radius:8px;font-size:16px}
        
        /* ä½ˆå±€ä¿®æ­£ï¼šå·¦å•†å“ã€å³è¦æ ¼ */
        .main-container{display:flex;flex:1;overflow:hidden}
        .left-menu{width:35%;background:#eee;overflow-y:auto;border-right:1px solid #ddd}
        .menu-item{padding:15px 10px;border-bottom:1px solid #ddd;cursor:pointer;font-size:0.9em}
        .menu-item.active{background:#fff;color:var(--blue);font-weight:bold;border-left:4px solid var(--blue)}
        
        .right-content{width:65%;background:#fff;overflow-y:auto;padding:15px}
        .spec-card{border:1px solid #f0f0f0;padding:12px;margin-bottom:10px;border-radius:8px;background:#fafafa}
        .qty-row{display:flex;align-items:center;justify-content:flex-end;gap:10px;margin-top:8px}
        .btn-qty{width:32px;height:32px;border:1px solid var(--blue);background:#fff;color:var(--blue);border-radius:50%;cursor:pointer}

        /* åº•éƒ¨æ¬„èˆ‡ä¿®æ­£æ˜ç´° */
        .bottom-bar{background:#fff;border-top:2px solid var(--blue);padding:10px 15px 25px}
        #cart-modal{position:fixed;bottom:80px;left:0;right:0;background:#fff;max-height:60%;overflow-y:auto;z-index:100;display:none;padding:20px;box-shadow:0 -5px 15px rgba(0,0,0,0.1);border-radius:15px 15px 0 0}
        
        /* ç®¡ç†å¾Œå° */
        #admin-panel{position:fixed;inset:0;background:#fff;z-index:1000;display:none;padding:20px;overflow-y:auto}
        table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
        th,td{border:1px solid #ddd;padding:8px;text-align:left}
    </style>
</head>
<body>

<header>
    <input type="text" id="user-nick" class="nick-input" placeholder="âœ è«‹è¼¸å…¥æš±ç¨±">
    <button id="admin-btn" onclick="toggleAdmin()" style="display:none;padding:10px;background:var(--blue);color:#fff;border:none;border-radius:5px">å¾Œå°</button>
</header>

<div class="main-container">
    <div id="left-menu" class="left-menu"></div>
    <div id="right-content" class="right-content">
        <p style="text-align:center;color:#999;margin-top:50px">â¬… è«‹é»é¸å·¦å´å•†å“</p>
    </div>
</div>

<div id="cart-modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">ğŸ›’ ä¿®æ­£ç™»è¨˜æ˜ç´°</h3>
        <button onclick="toggleCart()">é—œé–‰</button>
    </div>
    <div id="cart-list" style="margin-top:15px"></div>
</div>

<div class="bottom-bar" id="order-bar" style="display:none">
    <div style="display:flex;justify-content:space-between;margin-bottom:10px">
        <span onclick="toggleCart()" style="color:var(--blue);text-decoration:underline;cursor:pointer">ä¿®æ­£æ˜ç´° (<span id="cart-count">0</span>)</span>
        <span style="font-weight:bold;color:var(--red)">Total $<span id="total-val">0</span></span>
    </div>
    <button onclick="submitOrder()" style="width:100%;padding:15px;background:var(--blue);color:#fff;border:none;border-radius:10px;font-weight:bold">ç¢ºèªç™»è¨˜</button>
</div>

<div id="admin-panel">
    <div style="display:flex;justify-content:space-between"><h2>ğŸ“Š ç®¡ç†å¾Œå°çµ±è¨ˆ</h2><button onclick="toggleAdmin()">é€€å‡º</button></div>
    <div style="background:#fff5f5;padding:10px;border-radius:10px">
        <h3 style="margin-top:0;color:var(--red)">ğŸ“¦ æ¡è²·ç¸½æ•¸åŒ¯ç¸½</h3>
        <div id="stat-summary"></div>
    </div>
    <h3>ğŸ“ åŸå§‹è¨‚å–®ç´€éŒ„</h3>
    <div id="order-log"></div>
</div>

<script>
    // Firebase åˆå§‹åŒ–
    const config={apiKey:"AIzaSyD7KmXt_PjFzyYKz4tXGQAmz_wvmmSjAm4",databaseURL:"https://zoo-62638-default-rtdb.firebaseio.com",projectId:"zoo-62638"};
    firebase.initializeApp(config);
    const db = firebase.database();

    let cart = {}, cloudData = {};

    // ç›£è½æš±ç¨± (1239é–‹å¾Œå°)
    document.getElementById('user-nick').addEventListener('input', e => {
        document.getElementById('admin-btn').style.display = (e.target.value === '1239') ? 'block' : 'none';
    });

    // è®€å–è³‡æ–™
    db.ref('products').on('value', sn => {
        cloudData = sn.val() || {};
        renderLeft();
    });

    function renderLeft() {
        const left = document.getElementById('left-menu');
        left.innerHTML = "";
        Object.keys(cloudData).forEach(cat => {
            Object.keys(cloudData[cat]).forEach(id => {
                const p = cloudData[cat][id];
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.id = 'm-'+id;
                div.innerText = p.n;
                div.onclick = () => renderRight(cat, id);
                left.appendChild(div);
            });
        });
    }

    function renderRight(cat, id) {
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
        document.getElementById('m-'+id).classList.add('active');
        const p = cloudData[cat][id];
        const specs = p.s.split(',');
        let html = `<h3>${p.n}</h3>`;
        specs.forEach(s => {
            const k = `${cat}|${id}|${s.trim()}`;
            html += `<div class="spec-card">
                <div style="display:flex;justify-content:space-between"><span>${s.trim()}</span><b>$${p.p}</b></div>
                <div class="qty-row">
                    <button class="btn-qty" onclick="updateQty('${k}',-1)">-</button>
                    <b id="q-${k}">${cart[k]||0}</b>
                    <button class="btn-qty" onclick="updateQty('${k}',1)">+</button>
                </div>
            </div>`;
        });
        document.getElementById('right-content').innerHTML = html;
    }

    function updateQty(k, d) {
        cart[k] = (cart[k] || 0) + d;
        if(cart[k] <= 0) delete cart[k];
        const el = document.getElementById('q-'+k);
        if(el) el.innerText = cart[k] || 0;
        updateUI();
    }

    function updateUI() {
        let total = 0, count = 0, html = "";
        Object.keys(cart).forEach(k => {
            const b = k.split('|');
            const info = cloudData[b[0]][b[1]];
            total += info.p * cart[k];
            count += cart[k];
            html += `<div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee">
                <span>${info.n}(${b[2]}) x ${cart[k]}</span>
                <button onclick="updateQty('${k}',-1)">æ¸›1</button>
            </div>`;
        });
        document.getElementById('order-bar').style.display = count > 0 ? 'block' : 'none';
        document.getElementById('cart-count').innerText = count;
        document.getElementById('total-val').innerText = total;
        document.getElementById('cart-list').innerHTML = html || "å°šæœªé¸æ“‡å•†å“";
    }

    function toggleCart() {
        const m = document.getElementById('cart-modal');
