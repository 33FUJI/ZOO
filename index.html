<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>âœ¨ 33å‹•ç‰©åœ’ âœ¨</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root { --main: #b0a496; --bg: #fcf8f5; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; color: #5d5246; }
        header { background: var(--main); color: white; padding: 15px; text-align: center; font-size: 1.5em; font-weight: bold; }
        
        .user-bar { background: #fff; padding: 10px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 10px; }
        .nick-input { flex: 1; padding: 10px; border: 2px solid var(--main); border-radius: 8px; font-size: 1em; }

        .main-content { flex: 1; display: flex; overflow: hidden; padding: 10px; gap: 10px; }
        .item-list { flex: 1.5; overflow-y: auto; background: white; border-radius: 10px; padding: 15px; border: 1px solid #ddd; }
        .cart-box { flex: 1; background: white; border-radius: 10px; padding: 15px; border: 1px solid #ddd; display: flex; flex-direction: column; min-width: 280px; }
        
        .p-card { border: 1px solid #eee; padding: 12px; margin-bottom: 10px; border-radius: 8px; text-align: center; cursor: pointer; background: #fff; display: inline-block; width: 120px; margin-right: 8px; }
        .p-name { font-size: 0.9em; font-weight: bold; }
        .p-price { color: #c2966d; font-weight: bold; }

        .cart-items { flex: 1; overflow-y: auto; border-bottom: 1px solid #eee; margin-top: 10px; }
        .total-price { font-size: 2.5em; color: #d9534f; text-align: right; font-weight: bold; margin: 10px 0; }
        .order-btn { width: 100%; padding: 15px; background: #6b8e23; color: white; border: none; border-radius: 10px; font-size: 1.3em; font-weight: bold; cursor: pointer; }

        footer { padding: 10px; background: #fff; border-top: 1px solid #eee; text-align: center; }
        .admin-btn { padding: 8px 20px; background: var(--main); color: white; border-radius: 5px; border: none; cursor: pointer; }

        /* å¾Œå°æ¨£å¼ */
        #admin-panel { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 9999; }
        .admin-box { background: white; width: 95%; max-width: 500px; height: 80%; padding: 20px; border-radius: 15px; overflow-y: auto; }
    </style>
</head>
<body>

<header>âœ¨ 33å‹•ç‰©åœ’ âœ¨</header>

<div class="user-bar">
    <span>ğŸ‘¤ æš±ç¨±:</span>
    <input type="text" id="nick" class="nick-input" placeholder="è«‹å¡«å¯«æš±ç¨± (æ²’å¡«ç„¡æ³•ä¸‹å–®)">
</div>

<div class="main-content">
    <div class="item-list" id="display-area">
        <p style="text-align:center;">æ­£åœ¨è®€å–é›²ç«¯è³‡æ–™...</p>
    </div>
    
    <div class="cart-box">
        <strong>ğŸ›’ æˆ‘çš„æ¸…å–®</strong>
        <div id="cart-content" class="cart-items"></div>
        <div class="total-price">$<span id="sum">0</span></div>
        <button class="order-btn" onclick="submitOrder()">âœ… ç¢ºèªç™»è¨˜</button>
    </div>
</div>

<footer>
    <button class="admin-btn" onclick="openAdmin()">âš™ï¸ ç®¡ç†å¾Œå°</button>
</footer>

<div id="admin-panel">
    <div class="admin-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h3>ç®¡ç†å•†å“ (å¯†ç¢¼:1239)</h3>
            <button onclick="document.getElementById('admin-panel').style.display='none'">âœ• é—œé–‰</button>
        </div>
        <div style="background:#f9f9f9; padding:10px; border-radius:8px; margin-bottom:15px;">
            <input type="text" id="new-cat" placeholder="æ–°åˆ†é¡åç¨±">
            <button onclick="addCategory()">+ æ–°å¢åˆ†é¡</button>
            <hr>
            <select id="sel-cat"></select>
            <input type="text" id="p-n" placeholder="å“å" style="width:100px;">
            <input type="number" id="p-p" placeholder="å”®åƒ¹" style="width:60px;">
            <button onclick="addProduct()">+ åŠ å•†å“</button>
        </div>
        <div id="admin-list"></div>
    </div>
</div>

<script>
    // --- é€™è£¡è«‹ç¢ºèªä½ çš„è³‡æ–™åº«è³‡è¨Š ---
    const firebaseConfig = {
        apiKey: "AIzaSyD7KmXt_PjFzyYKz4tXGQAmz_wvmmSjAm4",
        authDomain: "zoo-62638.firebaseapp.com",
        databaseURL: "https://zoo-62638-default-rtdb.firebaseio.com",
        projectId: "zoo-62638",
        storageBucket: "zoo-62638.appspot.com",
        messagingSenderId: "123456789",
        appId: "1:123456789:web:abcdef"
    };

    let db, inv = [], cart = {};

    // 1. åˆå§‹åŒ–
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        db.ref('inventory').on('value', snap => {
            inv = snap.val() || [];
            renderAll();
        });
    } catch(e) {
        document.getElementById('display-area').innerHTML = "è³‡æ–™åº«é…ç½®éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ä»£ç¢¼ã€‚";
    }

    // 2. é¡¯ç¤ºå•†å“
    function renderAll() {
        const area = document.getElementById('display-area');
        area.innerHTML = '';
        if(inv.length === 0) area.innerHTML = "ç›®å‰æ²’å•†å“ï¼Œè«‹é»å¾Œå°æ–°å¢ã€‚";

        inv.forEach((c, ci) => {
            let html = `<div style="font-weight:bold; margin-top:15px; color:var(--main);">${c.cat}</div>`;
            c.items.forEach((it, ii) => {
                html += `<div class="p-card" onclick="toCart(${ci}, ${ii})">
                    <div class="p-name">${it.n}</div>
                    <div class="p-price">$${it.p}</div>
                </div>`;
            });
            area.innerHTML += html;
        });
        
        // æ›´æ–°å¾Œå°ä¸‹æ‹‰é¸å–®
        const sel = document.getElementById('sel-cat');
        sel.innerHTML = inv.map(c => `<option value="${c.cat}">${c.cat}</option>`).join('');
    }

    // 3. è³¼ç‰©è»Š
    function toCart(ci, ii) {
        const item = inv[ci].items[ii];
        if(!cart[item.n]) cart[item.n] = { ...item, q: 1 };
        else cart[item.n].q++;
        showCart();
    }

    function showCart() {
        const box = document.getElementById('cart-content');
        let total = 0; box.innerHTML = '';
        Object.values(cart).forEach(it => {
            total += it.p * it.q;
            box.innerHTML += `<div style="padding:5px; border-bottom:1px solid #eee;">${it.n} x ${it.q} = $${it.p * it.q}</div>`;
        });
        document.getElementById('sum').innerText = total;
    }

    // 4. ä¸‹å–®
    function submitOrder() {
        const nick = document.getElementById('nick').value.trim();
        if(!nick) return alert("è«‹å¡«å¯«æš±ç¨±ï¼");
        if(Object.keys(cart).length === 0) return alert("æ¸…å–®æ˜¯ç©ºçš„ï¼");
        db.ref('orders').push({ nick, items: Object.values(cart), total: document.getElementById('sum').innerText, time: new Date().toLocaleString() });
        alert("ç™»è¨˜æˆåŠŸï¼è«‹æˆªåœ–å‚³çµ¦ 33ï¼");
        cart = {}; showCart();
    }

    // 5. å¾Œå°ç®¡ç†
    function openAdmin() {
        if(prompt("è«‹è¼¸å…¥å¯†ç¢¼") === "1239") {
            document.getElementById('admin-panel').style.display = 'flex';
            showAdminList();
        }
    }
    function addCategory() {
        const n = document.getElementById('new-cat').value;
        if(n) { inv.push({cat: n, items: []}); save(); }
    }
    function addProduct() {
        const cN = document.getElementById('sel-cat').value;
        const n = document.getElementById('p-n').value, p = parseInt(document.getElementById('p-p').value);
        const cat = inv.find(x => x.cat === cN);
        if(cat && n) { cat.items.push({n, p}); save(); }
    }
    function save() { db.ref('inventory').set(inv); showAdminList(); }
    function showAdminList() {
        let h = "";
        inv.forEach((c, ci) => {
            h += `<p><b>${c.cat}</b> <button onclick="delCat(${ci})">åˆªé™¤åˆ†é¡</button></p>`;
            c.items.forEach((it, ii) => {
                h += `<div>${it.n} - $${it.p} <button onclick="delP(${ci},${ii})">åˆª</button></div>`;
            });
        });
        document.getElementById('admin-list').innerHTML = h;
    }
    function delP(ci, ii) { inv[ci].items.splice(ii,1); save(); }
    function delCat(ci) { if(confirm("ç¢ºå®šåˆªé™¤åˆ†é¡?")) { inv.splice(ci,1); save(); } }
</script>
</body>
</html>
