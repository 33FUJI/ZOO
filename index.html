<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>33 ä»£è³¼ç™»è¨˜</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #f8f9fa; margin: 0; padding-bottom: 80px; }
        header { background: #2c3e50; color: white; padding: 15px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 1000; }
        
        /* å¦³è¦æ±‚çš„åˆ†å€æ¡†æ¡†æ¨£å¼ */
        .category-section { margin: 20px auto; max-width: 600px; padding: 0 15px; }
        .category-title { font-weight: bold; color: #2c3e50; border-left: 5px solid #003399; padding-left: 10px; margin-bottom: 15px; }
        
        .item-card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #ddd; }
        .item-info { display: flex; justify-content: space-between; margin-bottom: 10px; }
        
        /* è¦æ ¼æŒ‰éˆ•æ¨£å¼ */
        .spec-wrap { display: flex; flex-wrap: wrap; gap: 8px; }
        .spec-btn { padding: 10px 12px; border: 1px solid #ccc; border-radius: 5px; background: #fff; cursor: pointer; flex: 1; min-width: 60px; text-align: center; font-weight: bold; }
        .spec-btn:active { background: #003399; color: white; }

        /* åŸå§‹å½ˆçª—èˆ‡é¢æ¿ ID (ä¸å¯äº‚å‹•) */
        #bottom-panel { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 20px; border-top: 2px solid #ddd; display: none; flex-direction: column; gap: 10px; z-index: 2000; }
        .input-box { padding: 12px; border: 1px solid #ddd; border-radius: 8px; width: 100%; box-sizing: border-box; }
        .full-panel { position: fixed; inset: 0; background: white; z-index: 3000; display: none; flex-direction: column; padding: 20px; overflow-y: auto; }
        
        .admin-trigger { position: fixed; bottom: 10px; right: 10px; color: #ccc; cursor: pointer; padding: 10px; z-index: 5000; }
    </style>
</head>
<body>

<header onclick="location.reload()">ğŸ’™ 33 ä»£è³¼ç™»è¨˜</header>

<div id="display-area">è®€å–ä¸­...</div>

<div style="text-align: center; margin-top: 20px;">
    <button onclick="document.getElementById('search-panel').style.display='flex'" style="background: none; border: 1px solid #ccc; padding: 10px 20px; border-radius: 20px; color: #888;">ğŸ” æŸ¥çœ‹ç™»è¨˜é€²åº¦</button>
</div>

<div id="bottom-panel">
    <div id="target-display" style="font-weight: bold; color: #003399;"></div>
    <input type="text" id="order-name" class="input-box" placeholder="è¨‚å–®åç¨± (å¦‚ï¼šç¬¬ä¸€æ³¢ã€ç¾å ´)">
    <input type="text" id="user-nick" class="input-box" placeholder="æ‚¨çš„æš±ç¨± (å¿…å¡«)">
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <span>æ•¸é‡ï¼š</span>
        <input type="number" id="target-qty" value="1" min="1" style="width: 80px; padding: 10px; border: 1px solid #ddd;">
    </div>
    <div style="display: flex; gap: 10px;">
        <button onclick="submitData()" style="flex: 2; padding: 15px; background: #2c3e50; color: white; border: none; border-radius: 8px; font-weight: bold;">ç¢ºèªé€å‡º</button>
        <button onclick="document.getElementById('bottom-panel').style.display='none'" style="flex: 1; padding: 15px; background: #eee; border: none; border-radius: 8px;">å–æ¶ˆ</button>
    </div>
</div>

<div id="search-panel" class="full-panel">
    <div style="display:flex; justify-content:space-between;"><h3>ğŸ“Š ç™»è¨˜çœ‹æ¿</h3><button onclick="this.parentElement.parentElement.style.display='none'">âœ•</button></div>
    <div id="live-board">å°šæœªæœ‰ç™»è¨˜è³‡æ–™</div>
</div>

<div id="admin-panel" class="full-panel">
    <div style="display:flex; justify-content:space-between;"><h3>âš™ï¸ è€é—†ç®¡ç†</h3><button onclick="this.parentElement.parentElement.style.display='none'">âœ•</button></div>
    <div style="background: #eef; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
        <button onclick="seedInitialData()" style="width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 8px; margin-bottom: 10px;">ğŸ”„ é»æˆ‘ï¼šä¸€éµé‡æ–°ä¸Šæ¶å•†å“</button>
        <strong>ç®¡ç†å•†å“ï¼š</strong><br>
        <input type="text" id="adm-cat" class="input-box" placeholder="åˆ†å€">
        <input type="text" id="adm-name" class="input-box" placeholder="å•†å“åç¨±">
        <input type="number" id="adm-price" class="input-box" placeholder="åƒ¹æ ¼">
        <input type="number" id="adm-stock" class="input-box" placeholder="é™é¡">
        <button onclick="saveProduct()" style="width: 100%; padding: 12px; background: green; color: white; border: none; border-radius: 8px; margin-top: 5px;">å„²å­˜å•†å“</button>
    </div>
    <div id="adm-list-area"></div>
</div>

<div class="admin-trigger" onclick="if(prompt('å¯†ç¢¼')==='3388') document.getElementById('admin-panel').style.display='flex'">.</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyD7KmXt_PjFzyYKz4tXGQAmz_wvmmSjAm4",
    authDomain: "zoo-62638.firebaseapp.com",
    databaseURL: "https://zoo-62638-default-rtdb.firebaseio.com",
    projectId: "zoo-62638",
    storageBucket: "zoo-62638.firebasestorage.app",
    messagingSenderId: "33012710753",
    appId: "1:33012710753:web:318636add1f5ac2f7b5920"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let items = {}, orders = {}, activeKey = "", activeSpec = "";

// ä¸€éµä¸Šæ¶ (çµ•ä¸åˆªæ¸›)
function seedInitialData() {
    if(!confirm("ç¢ºå®šé‡æ–°ä¸Šæ¶ï¼Ÿ")) return;
    const data = {};
    const list = [
        { cat: "ğŸ›’ æ—¥æœ¬è¶…å¸‚å€", name: "è¶…å¸‚é¤…ä¹¾", price: 200, stock: 20 },
        { cat: "ğŸ›’ æ—¥æœ¬è¶…å¸‚å€", name: "è¶…å¸‚å°é£Ÿ", price: 150, stock: 20 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "T-shirt (M/L)", price: 1200, stock: 10 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ‹‰éŠé€£å¸½è¡« (M/L)", price: 2700, stock: 10 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å‹•ç‰©æ£’æ£’ç³–åŠé£¾ (åˆ†æˆå“¡)", price: 500, stock: 45 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "é¦¬å…‹æ¯ (åˆ†æˆå“¡)", price: 800, stock: 18 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å£“å…‹åŠ›ç«‹ç‰Œ(åˆ†æˆå“¡)", price: 700, stock: 27 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å§“åç‰Œ(åˆ†æˆå“¡)", price: 450, stock: 45 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ–¹å·¾", price: 700, stock: 20 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å¯æŠ˜ç’°ä¿è¢‹", price: 750, stock: 15 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ‰‹æè¢‹", price: 1150, stock: 10 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "å¾½ç« (éš¨æ©Ÿ)", price: 380, stock: 100 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "éš¨æ©Ÿå¡åŒ…", price: 150, stock: 200 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "éš¨æ©Ÿé›¶é£Ÿç›’", price: 500, stock: 30 },
        { cat: "ğŸ’ SS10 é€±é‚Šå€", name: "æ‰­è›‹(éš¨æ©Ÿ)", price: 200, stock: 100 }
    ];
    list.forEach(i => { const k = db.ref("products").push().key; data[k] = { ...i, key: k }; });
    db.ref("products").set(data).then(() => alert("å•†å“ä¸Šæ¶æˆåŠŸï¼"));
}

function saveProduct() {
    const k = db.ref("products").push().key;
    db.ref("products/"+k).set({
        cat: document.getElementById('adm-cat').value,
        name: document.getElementById('adm-name').value,
        price: parseInt(document.getElementById('adm-price').value),
        stock: parseInt(document.getElementById('adm-stock').value),
        key: k
    });
}

// ç›£è½ Firebase (çµ•ä¸åˆªæ¸›)
db.ref("products").on("value", (s) => {
    items = s.val() || {};
    const area = document.getElementById('display-area');
    const cats = [...new Set(Object.values(items).map(i => i.cat))].sort((a,b) => a.includes("è¶…å¸‚") ? -1 : 1);
    
    area.innerHTML = cats.map(c => `
        <div class="category-section">
            <div class="category-title">${c}</div>
            ${Object.values(items).filter(i => i.cat === c).map(i => {
                let specs = [];
                if(i.name.includes("(M/L)")) specs = ["M", "L"];
                else if(i.name.includes("(åˆ†æˆå“¡)")) specs = ["ç‰¹", "æ¾ˆ", "é›²", "ç«¥", "èµ«", "æµ·", "æº", "æ—­", "åœ­"];
                
                return `
                    <div class="item-card">
                        <div class="item-info"><b>${i.name}</b><span style="color:red">NT${i.price}</span></div>
                        <div class="spec-wrap">
                            ${specs.length > 0 ? 
                                specs.map(s => `<div class="spec-btn" onclick="startOrder('${i.key}','${s}')">${s}</div>`).join('') :
                                `<div class="spec-btn" style="background:#2c3e50; color:white;" onclick="startOrder('${i.key}','')">ç™»è¨˜</div>`
                            }
                        </div>
                    </div>`;
            }).join('')}
        </div>`).join('') || "è«‹åˆå§‹åŒ–è³‡æ–™";
});

function startOrder(k, s) {
    activeKey = k; activeSpec = s;
    document.getElementById('target-display').innerText = items[k].name + (s ? " ["+s+"]" : "");
    document.getElementById('bottom-panel').style.display = 'flex';
}

function submitData() {
    const nick = document.getElementById('user-nick').value;
    if(!nick) return alert("è«‹å¡«å¯«æš±ç¨±");
    db.ref("history").push({
        timestamp: Date.now(),
        itemKey: activeKey,
        itemName: items[activeKey].name + (activeSpec ? " ["+activeSpec+"]" : ""),
        note: nick,
        orderName: document.getElementById('order-name').value,
        qty: parseInt(document.getElementById('target-qty').value
