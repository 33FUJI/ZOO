<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>33æ—¥æœ¬å‹•ç‰©åœ’</title>
<script src=""></script>
<script src="
<body>
<header>âœ¨ 33æ—¥æœ¬å‹•ç‰©åœ’ âœ¨</header>
<div class="top-section">
<input type="text" id="user-nick" class="nick-input" placeholder="âœ è¼¸å…¥æš±ç¨± (ä¸‹å–®ç”¨ / å¯†ç¢¼ 1239)">
<div style="display:flex; justify-content:space-between; margin-top:10px;">
<button onclick="fetchHistory()" style="background:none; border:none; color:var(--blue); text-decoration:underline; font-size:0.9em; cursor:pointer;">ğŸ” æŸ¥è©¢æˆ‘çš„ç´€éŒ„</button>
<button id="admin-trigger" onclick="toggleAdmin()" style="display:none; background:var(--gold); border:none; color:white; padding:5px 12px; border-radius:5px; font-size:0.8em;">ğŸ›  ç®¡ç†å¾Œå°</button>
</div>
</div>
<div class="cat-grid" id="main-grid"></div>
<div id="admin-area" style="display:none; padding-bottom:100px;">
<div class="admin-box">
<h3>â• è‡ªè¡Œæ–°å¢å•†å“</h3>
<input id="ad-cat" style="width:100%;margin-bottom:5px;" placeholder="åˆ†é¡">
<input id="ad-name" style="width:100%;margin-bottom:5px;" placeholder="åç¨±">
<input id="ad-price" style="width:100%;margin-bottom:5px;" type="number" placeholder="åƒ¹æ ¼">
<input id="ad-spec" style="width:100%;margin-bottom:10px;" placeholder="è¦æ ¼(é€—è™Ÿéš”é–‹)">
<button onclick="saveProduct()" style="width:100%; background:#28a745; color:#fff; padding:10px; border:none; border-radius:5px;">ç¢ºèªä¸Šæ¶</button>
</div>
<div class="admin-box">
<h3>ğŸ“‹ è¨‚å–®å½™æ•´æ¸…å–®</h3>
<button onclick="loadAllOrders()">åˆ·æ–°åˆ—è¡¨</button>
<div id="order-table" style="overflow-x:auto; margin-top:10px;"></div>
</div>
</div>
<div id="history-modal" class="modal"><div class="modal-header"><span onclick="closeHistory()" style="cursor:pointer;font-weight:bold;color:var(--blue)">â® è¿”å›</span><h2 style="font-size:1.1em;margin:0">æ­·å²ç™»è¨˜</h2><div></div></div><div id="history-list" style="overflow-y:auto;flex:1;padding:10px;"></div></div>
<div id="item-modal" class="modal"><div class="modal-header"><span onclick="closeModal()" style="cursor:pointer;font-weight:bold;color:var(--blue)">â® è¿”å›</span><h2 id="cat-title" style="font-size:1.1em;margin:0"></h2><div></div></div><div id="p-list" style="overflow-y:auto;flex:1"></div></div>
<div class="order-area" id="order-bar" style="display:none">
<div id="cart-list" class="cart-detail"></div>
<div style="display:flex; justify-content:space-between; align-items:center;">
<div style="font-size:0.8em; color:#999;" onclick="clearCart()">ğŸ—‘ï¸ æ¸…ç©ºé‡é¸</div>
<div style="text-align:right; font-weight:bold; color:var(--red); font-size:1.4em;">ç¸½è¨ˆ $<span id="total-val">0</span></div>
</div>
<button class="submit-btn" onclick="submitOrder()">âœ… ç¢ºèªç™»è¨˜ä¸‹å–®</button>
</div>
<script>
var config={apiKey:"AIzaSyD7KmXt_PjFzyYKz4tXGQAmz_wvmmSjAm4",databaseURL:"",projectId:"zoo-62638"};
firebase.initializeApp(config); var db=firebase.database(); var cart={}, cloudData={};
document.getElementById('user-nick').addEventListener('input', e=>{
document.getElementById('admin-trigger').style.display=(e.target.value==='1239')?'block':'none';
});
function toggleAdmin(){
var x=document.getElementById('admin-area'); x.style.display=(x.style.display==='none')?'block':'none';
if(x.style.display==='block') loadAllOrders();
}
db.ref('products').on('value', sn=>{ cloudData=sn.val()||{}; renderCards(); });
function renderCards(){
var grid=document.getElementById('main-grid'); grid.innerHTML='';
Object.keys(cloudData).forEach(cat=>{ grid.innerHTML+=&lt;div class=&quot;cat-card&quot; onclick=&quot;openCat(&#39;${cat}&#39;)&quot;&gt;&lt;h3&gt;${cat}&lt;/h3&gt;&lt;/div&gt;; });
}
function openCat(cat){
document.getElementById('cat-title').innerText=cat; var list=document.getElementById('p-list'); list.innerHTML='';
var items=cloudData[cat]; Object.keys(items).forEach(id=>{
var p=items[id]; var specs=p.s.split(','); var specHtml=specs.map(s=>{
var k=cat+'|'+id+'|'+s; return &lt;div class=&quot;spec-item&quot;&gt;&lt;span&gt;${s}&lt;/span&gt;&lt;div class=&quot;qty-controls&quot;&gt;&lt;button class=&quot;qty-btn&quot; onclick=&quot;updateQty(&#39;${k}&#39;,-1)&quot;&gt;-&lt;/button&gt;&lt;span id=&quot;num-${k}&quot; style=&quot;min-width:30px;text-align:center&quot;&gt;${cart[k]||0}&lt;/span&gt;&lt;button class=&quot;qty-btn&quot; onclick=&quot;updateQty(&#39;${k}&#39;,1)&quot;&gt;+&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;;
}).join('');
list.innerHTML+=&lt;div class=&quot;p-group&quot;&gt;&lt;div class=&quot;p-header&quot;&gt;&lt;span&gt;${p.n}&lt;/span&gt;&lt;span style=&quot;color:var(--red)&quot;&gt;$${p.p}&lt;/span&gt;&lt;/div&gt;${specHtml}&lt;/div&gt;;
}); document.getElementById('item-modal').style.display='flex';
}
function updateQty(k,d){ cart[k]=(cart[k]||0)+d; if(cart[k]<=0)delete cart[k]; var el=document.getElementById('num-'+k); if(el)el.innerText=cart[k]||0; updateCartUI(); }
function updateCartUI(){
var bar=document.getElementById('order-bar'), list=document.getElementById('cart-list'), keys=Object.keys(cart);
if(!keys.length){bar.style.display='none';return} bar.style.display='block'; list.innerHTML=''; var total=0;
keys.forEach(k=>{ var p=k.split('|'); var info=cloudData[p[0]][p[1]]; total+=info.p*cart[k]; list.innerHTML+=&lt;div style=&quot;display:flex;justify-content:space-between&quot;&gt;&lt;span&gt;${info.n}(${p[2]})&lt;/span&gt;&lt;span&gt;x${cart[k]}&lt;/span&gt;&lt;/div&gt;; });
document.getElementById('total-val').innerText=total;
}
function submitOrder(){
var nick=document.getElementById('user-nick').value; if(!nick||nick==='1239')return alert("è«‹è¼¸å…¥æš±ç¨±");
db.ref('orders').push({nick:nick, time:new Date().toLocaleString(), items:cart, total:document.getElementById('total-val').innerText}).then(()=>{alert("âœ… ç™»è¨˜æˆåŠŸï¼"); clearCart();});
}
function fetchHistory(){
var nick=document.getElementById('user-nick').value; if(!nick||nick==='1239')return alert("è«‹å…ˆè¼¸å…¥æš±ç¨±");
var list=document.getElementById('history-list'); list.innerHTML="è®€å–ä¸­..."; document.getElementById('history-modal').style.display='flex';
db.ref('orders').orderByChild('nick').equalTo(nick).once('value', sn=>{
list.innerHTML=""; if(!sn.exists()){list.innerHTML="ç„¡ç´€éŒ„"; return;}
sn.forEach(d=>{ var v=d.val(); var detail=""; Object.keys(v.items).forEach(k=>{ var p=k.split('|'); detail+=&lt;div&gt;â–ªï¸ ${p[0]}-${p[2]} x${v.items[k]}&lt;/div&gt;; });
list.innerHTML+=&lt;div class=&quot;admin-box&quot;&gt;&lt;small&gt;${v.time}&lt;/small&gt;&lt;div&gt;${detail}&lt;/div&gt;&lt;div style=&quot;text-align:right;color:var(--red)&quot;&gt;$${v.total}&lt;/div&gt;&lt;/div&gt;; });
});
}
function saveProduct(){
var c=document.getElementById('ad-cat').value, n=document.getElementById('ad-name').value, p=document.getElementById('ad-price').value, s=document.getElementById('ad-spec').value;
if(!c||!n||!p)return alert("ç¼ºé …"); db.ref('products/'+c).push({n:n, p:parseInt(p), s:s||"å–®ä¸€è¦æ ¼"}); alert("å®Œæˆ");
}
function loadAllOrders(){
db.ref('orders').once('value', sn=>{
var html='<table><tr><th>æš±ç¨±</th><th>å…§å®¹</th><th>ç¸½è¨ˆ</th></tr>';
sn.forEach(d=>{ var v=d.val(); var detail=""; Object.keys(v.items).forEach(k=>{ var p=k.split('|'); detail+=p[2]+" x"+v.items[k]+"


"; });
html+=&lt;tr&gt;&lt;td&gt;${v.nick}&lt;/td&gt;&lt;td&gt;${detail}&lt;/td&gt;&lt;td&gt;$${v.total}&lt;/td&gt;&lt;/tr&gt;; });
html+='</table>'; document.getElementById('order-table').innerHTML=html;
});
}
function closeHistory(){document.getElementById('history-modal').style.display='none'}
function closeModal(){document.getElementById('item-modal').style.display='none'}
function clearCart(){cart={}; updateCartUI(); closeModal();}
</script>

</body>
</html>
