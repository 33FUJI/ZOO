<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>33æ—¥æœ¬å‹•ç‰©åœ’</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --bg-creamy: #fdfaf5; /* æº«æŸ”å¥¶æ²¹åº•è‰² */
            --accent-soft: #a8b2c1;
            --text-gray: #666666;
            --btn-green: #a2d2a2;
            --radius-lg: 24px;
        }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg-creamy); color: var(--text-gray); margin: 0; padding-bottom: 120px; }
        
        header { padding: 40px 20px 20px; text-align: center; font-size: 1.5em; font-weight: bold; color: #8a7b6a; }

        /* é ‚éƒ¨æš±ç¨± */
        .user-box { padding: 0 20px 25px; }
        .user-input { width: 100%; padding: 18px; border-radius: var(--radius-lg); border: 2px solid #efeee5; font-size: 1.1em; box-sizing: border-box; background: white; outline: none; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }

        /* å ´æ¬¡å¡ç‰‡ */
        .cat-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
        .cat-card { background: white; padding: 35px 15px; border-radius: var(--radius-lg); text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.04); cursor: pointer; border: 1px solid #fcfcfc; }
        .cat-card h3 { margin: 0; font-size: 1.1em; color: #8a9aaa; }
        .cat-card span { font-size: 0.8em; color: #ccc; margin-top: 10px; display: block; }

        /* å•†å“åˆ—è¡¨å…¨è¢å¹•å½ˆçª— */
        .modal { position: fixed; inset: 0; background: var(--bg-creamy); z-index: 2000; display: none; flex-direction: column; }
        .modal-nav { padding: 20px; background: white; display: flex; align-items: center; border-bottom: 1px solid #f0f0f0; }
        .close-icon { font-size: 1.8em; cursor: pointer; margin-right: 15px; color: var(--accent-soft); }
        .product-scroll { flex: 1; overflow-y: auto; padding: 20px; }

        /* å•†å“é …ç›® */
        .product-item { background: white; margin-bottom: 15px; border-radius: var(--radius-lg); padding: 20px; border: 1px solid #f5f5f5; }
        .p-info { display: flex; justify-content: space-between; align-items: center; font-weight: bold; margin-bottom: 15px; }
        .spec-item { display: flex; justify-content: space-between; align-items: center; background: #fafafa; padding: 12px 18px; border-radius: 15px; margin-top: 8px; }
        .qty-ctrl { display: flex; align-items: center; gap: 15px; }
        .btn-qty { width: 32px; height: 32px; border-radius: 10px; border: none; background: #eceef1; color: #999; font-weight: bold; }

        /* åº•éƒ¨çµå¸³æ¢ */
        .footer-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 20px; border-radius: 30px 30px 0 0; box-shadow: 0 -10px 30px rgba(0,0,0,0.05); z-index: 3000; }
        .price-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .final-price { font-size: 2.2em; font-weight: bold; color: #e67e22; }
        .btn-submit { width: 100%; padding: 18px; border-radius: var(--radius-lg); border: none; background: var(--btn-green); color: white; font-size: 1.3em; font-weight: bold; }

        /* ç®¡ç†å€åŸŸé è¨­éš±è— */
        #admin-zone { padding: 20px; background: #eee; border-radius: 15px; margin: 20px; display: none; }
        input[type="text"], input[type="number"] { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<header>âœ¨ 33æ—¥æœ¬å‹•ç‰©åœ’ âœ¨</header>

<div class="user-box">
    <input type="text" id="user-nick" class="user-input" placeholder="è«‹å¡«å¯«æ‚¨çš„æš±ç¨± (å¿…å¡«)">
</div>

<div class="cat-container" id="cat-list">
    <div class="cat-card" onclick="openCat('æ—¥æœ¬è¶…å¸‚')"><h3>ğŸ›’ æ—¥æœ¬è¶…å¸‚</h3><span>é»æ“Šé¸è³¼</span></div>
    <div class="cat-card" onclick="openCat('æ—¥æœ¬æ´»å‹•ä»£è³¼')"><h3>âœ¨ æ—¥æœ¬æ´»å‹•ä»£è³¼</h3><span>é»æ“Šé¸è³¼</span></div>
</div>

<div id="item-modal" class="modal">
    <div class="modal-nav">
        <span class="close-icon" onclick="closeModal()">â®</span>
        <h2 id="cat-title" style="margin:0; font-size:1.2em;">å•†å“æ¸…å–®</h2>
    </div>
    <div class="product-scroll" id="product-container"></div>
</div>

<div class="footer-bar" id="checkout-bar" style="display:none;">
    <div id="summary" style="font-size:0.85em; color:#999; margin-bottom:10px; max-height:60px; overflow:auto;"></div>
    <div class="price-row">
        <span style="font-weight:bold;">ç¸½é‡‘é¡ï¼š</span>
        <span class="final-price">$<span id="total-val">0</span></span>
    </div>
    <button class="btn-submit" onclick="sendOrder()">ç¢ºèªç™»è¨˜é€å‡º</button>
</div>

<center style="margin-top:50px;">
    <button onclick="authAdmin()" style="background:none; border:none; color:#ddd; text-decoration:underline;">é€²å…¥ç®¡ç†æ¨¡å¼</button>
</center>

<div id="admin-zone">
    <h4>ä¸Šæ¶æ–°å•†å“</h4>
    <input type="text" id="a-cat" placeholder="æ´»å‹•åˆ†é¡ (å¦‚ï¼šæ—¥æœ¬è¶…å¸‚)">
    <input type="text" id="a-name" placeholder="å•†å“åç¨±">
    <input type="number" id="a-price" placeholder="åƒ¹æ ¼">
    <input type="text" id="a-spec" placeholder="è¦æ ¼ (ç”¨/éš”é–‹ï¼Œå¦‚: M/Lï¼Œç„¡å‰‡ç•™ç©º)">
    <button onclick="saveProduct()" style="width:100%; padding:10px; background:#8a7b6a; color:white; border:none; border-radius:8px;">ç«‹å³ä¸Šæ¶</button>
    <div id="admin-items" style="margin-top:20px; font-size:0.8em;"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD7KmXt_PjFzyYKz4tXGQAmz_wvmmSjAm4",
        authDomain: "zoo-62638.firebaseapp.com",
        databaseURL: "https://zoo-62638-default-rtdb.firebaseio.com",
        projectId: "zoo-62638",
        storageBucket: "zoo-62638.firebasestorage.app",
        messagingSenderId: "33012710753",
        appId: "1:33012710753:web:318636add1f5ac2f7b5920"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let prods = {}, cart = {};

    function start() {
        db.ref('products').on('value', snap => {
            prods = snap.val() || {};
            showCats();
            showAdminItems();
        });
    }

    function showCats() {
        const area = document.getElementById('cat-list');
        let cats = [...new Set(Object.values(prods).map(p => p.cat))];
        if(cats.length === 0) cats = ["æ—¥æœ¬è¶…å¸‚", "æ—¥æœ¬æ´»å‹•ä»£è³¼"];
        area.innerHTML = '';
        cats.forEach(c => {
            area.innerHTML += `<div class="cat-card" onclick="openCat('${c}')"><h3>${c}</h3><span>é»æ“Šé¸è³¼</span></div>`;
        });
    }

    function openCat(cName) {
        document.getElementById('cat-title').innerText = cName;
        const box = document.getElementById('product-container');
        box.innerHTML = '';
        let count = 0;
        Object.keys(prods).forEach(id => {
            const p = prods[id];
            if(p.cat === cName) {
                count++;
                let specs = p.spec ? p.spec.split('/') : ['ä¸€èˆ¬'];
                let sHtml = '';
                specs.forEach(s => {
                    const key = `${id}_${s}`;
                    const q = cart[key] || 0;
                    sHtml += `<div class="spec-item">
                        <span>${s === 'ä¸€èˆ¬' ? 'æ•¸é‡' : s}</span>
                        <div class="qty-ctrl">
                            <button class="btn-qty" onclick="change('${key}', -1)">-</button>
                            <span style="font-weight:bold;">${q}</span>
                            <button class="btn-qty" onclick="change('${key}', 1)">+</button>
                        </div>
                    </div>`;
                });
                box.innerHTML += `<div class="product-item">
                    <div class="p-info"><span>${p.name}</span><span style="color:#e67e22">$${p.price}</span></div>
                    ${sHtml}
                </div>`;
            }
        });
        if(count === 0) box.innerHTML = '<p style="text-align:center; color:#ccc; margin-top:100px;">æ­¤åˆ†é¡å°šç„¡å•†å“</p>';
        document.getElementById('item-modal').style.display = 'flex';
    }

    function change(key, d) {
        cart[key] = Math.max(0, (cart[key] || 0) + d);
        if(cart[key] === 0) delete cart[key];
        openCat(document.getElementById('cat-title').innerText);
        updateBar();
    }

    function updateBar() {
        const bar = document.getElementById('checkout-bar');
        const sum = document.getElementById('summary');
        const total = document.getElementById('total-val');
        const keys = Object.keys(cart);
        if(keys.length === 0) { bar.style.display = 'none'; return; }
        bar.style.display = 'block';
        let t = 0; let txt = [];
        keys.forEach(k => {
            const [pid, s] = k.split('_');
            const p = prods[pid];
            if(p) { t += p.price * cart[k]; txt.push(`${p.name}(${s})x${cart[k]}`); }
        });
        sum.innerText = txt.join(', ');
        total.innerText = t;
    }

    function sendOrder() {
        const nick = document.getElementById('user-nick').value.trim();
        if(!nick) return alert("è«‹è¼¸å…¥æš±ç¨±ï¼");
        db.ref('orders').push({
            nick, time: new Date().toLocaleString(),
            items: Object.keys(cart).map(k => {
                const [pid, s] = k.split('_');
                return { n: prods[pid].name, s, q: cart[k], p: prods[pid].price };
            }),
            total: document.getElementById('total-val').innerText
        }).then(() => {
            alert("ç™»è¨˜å®Œæˆï¼"); cart = {}; updateBar(); closeModal();
        });
    }

    function authAdmin() {
        if(prompt("è«‹è¼¸å…¥å¯†ç¢¼") === "1239") document.getElementById('admin-zone').style.display = 'block';
    }

    function saveProduct() {
        const cat = document.getElementById('a-cat').value;
        const name = document.getElementById('a-name').value;
        const price = parseInt(document.getElementById('a-price').value);
        const spec = document.getElementById('a-spec').value;
        if(!cat || !name || !price) return alert("è³‡è¨Šä¸å®Œæ•´");
        db.ref('products').push({cat, name, price, spec});
        alert("ä¸Šæ¶æˆåŠŸï¼");
    }

    function showAdminItems() {
        const area = document.getElementById('admin-items');
        area.innerHTML = '<strong>ç›®å‰æ¶ä¸Šï¼š</strong><br>';
        Object.keys(prods).forEach(id => {
            area.innerHTML += `[${prods[id].cat}] ${prods[id].name} <button onclick="del('${id}')" style="color:red">åˆªé™¤</button><br>`;
        });
    }

    function del(id) { if(confirm("åˆªé™¤ï¼Ÿ")) db.ref('products/'+id).remove(); }
    function closeModal() { document.getElementById('item-modal').style.display = 'none'; }

    start();
</script>
</body>
</html>
